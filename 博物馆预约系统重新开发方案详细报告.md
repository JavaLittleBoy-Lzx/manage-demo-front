# 博物馆预约系统重新开发方案详细报告

## 方案概述

本报告详细分析了重新开发中国（哈尔滨）森林博物馆预约系统的完整方案，包括技术选型、系统架构设计、开发计划、成本分析和风险评估等方面。

## 1. 项目背景与目标

### 1.1 项目背景
- **项目名称**: 中国（哈尔滨）森林博物馆预约系统
- **开发方式**: 全新开发
- **目标用户**: 普通游客、团体游客、博物馆管理员、系统管理员
- **业务目标**: 提供完整的博物馆预约、管理和统计服务

### 1.2 系统目标
- 构建专业的博物馆预约管理平台
- 实现高效的预约流程和用户体验
- 提供完善的数据统计和分析功能
- 建立可扩展的系统架构
- 确保系统安全性和稳定性

## 2. 技术架构设计

### 2.1 技术栈选择

#### 前端技术栈
```json
{
  "framework": "Vue 3.3.0",
  "ui-library": "Element Plus 2.4.0",
  "state-management": "Pinia 2.1.0",
  "router": "Vue Router 4.2.0",
  "http-client": "Axios 1.6.0",
  "build-tool": "Vite 4.5.0",
  "css-preprocessor": "Sass 1.69.0",
  "typescript": "TypeScript 5.2.0"
}
```

#### 后端技术栈
```json
{
  "framework": "Spring Boot 3.1.0",
  "database": "MySQL 8.0",
  "cache": "Redis 7.0",
  "security": "Spring Security 6.1.0",
  "documentation": "Swagger 3.0",
  "message-queue": "RabbitMQ 3.12.0",
  "monitoring": "Spring Boot Actuator"
}
```

#### 部署技术栈
```json
{
  "containerization": "Docker 24.0",
  "orchestration": "Docker Compose",
  "web-server": "Nginx 1.25.0",
  "ci-cd": "GitLab CI/CD",
  "monitoring": "Prometheus + Grafana"
}
```

### 2.2 系统架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        用户层                                │
├─────────────────┬─────────────────┬─────────────────────────┤
│   普通游客端     │    管理员端      │      移动端(未来)        │
└─────────────────┴─────────────────┴─────────────────────────┘
                           │
┌─────────────────────────────────────────────────────────────┐
│                      前端应用层                              │
├─────────────────────────────────────────────────────────────┤
│  Vue 3 + Element Plus + Pinia + TypeScript                 │
└─────────────────────────────────────────────────────────────┘
                           │
┌─────────────────────────────────────────────────────────────┐
│                      API网关层                              │
├─────────────────────────────────────────────────────────────┤
│  Nginx + 负载均衡 + SSL终端 + 限流                          │
└─────────────────────────────────────────────────────────────┘
                           │
┌─────────────────────────────────────────────────────────────┐
│                      业务服务层                              │
├─────────────┬─────────────┬─────────────┬─────────────────┤
│  用户服务    │  预约服务    │  统计服务    │    通知服务      │
└─────────────┴─────────────┴─────────────┴─────────────────┘
                           │
┌─────────────────────────────────────────────────────────────┐
│                      数据访问层                              │
├─────────────────┬─────────────────┬─────────────────────────┤
│   MySQL主库      │   MySQL从库      │      Redis缓存          │
└─────────────────┴─────────────────┴─────────────────────────┘
```

### 2.3 数据库设计

#### 核心数据表结构

```sql
-- 用户表
CREATE TABLE `users` (
  `id` bigint PRIMARY KEY AUTO_INCREMENT,
  `name` varchar(50) NOT NULL COMMENT '姓名',
  `id_card` varchar(18) UNIQUE NOT NULL COMMENT '身份证号',
  `phone` varchar(11) NOT NULL COMMENT '手机号',
  `email` varchar(100) COMMENT '邮箱',
  `birth_date` date COMMENT '出生日期',
  `gender` tinyint COMMENT '性别 1-男 2-女',
  `visit_count` int DEFAULT 0 COMMENT '参观次数',
  `blacklist_status` tinyint DEFAULT 0 COMMENT '黑名单状态',
  `blacklist_reason` text COMMENT '拉黑原因',
  `blacklist_date` datetime COMMENT '拉黑时间',
  `blacklist_release_date` datetime COMMENT '解除时间',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 预约表
CREATE TABLE `reservations` (
  `id` bigint PRIMARY KEY AUTO_INCREMENT,
  `reservation_no` varchar(32) UNIQUE NOT NULL COMMENT '预约编号',
  `user_id` bigint NOT NULL COMMENT '用户ID',
  `type` tinyint NOT NULL COMMENT '预约类型 1-个人 2-团体',
  `visit_date` date NOT NULL COMMENT '参观日期',
  `time_slot` varchar(20) NOT NULL COMMENT '时间段',
  `visitor_count` int NOT NULL COMMENT '参观人数',
  `status` tinyint DEFAULT 1 COMMENT '状态 1-待审核 2-已通过 3-已拒绝 4-已取消 5-已完成',
  `audit_user_id` bigint COMMENT '审核人ID',
  `audit_time` datetime COMMENT '审核时间',
  `audit_comment` text COMMENT '审核意见',
  `qr_code` varchar(255) COMMENT '二维码',
  `check_in_time` datetime COMMENT '入馆时间',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX `idx_user_id` (`user_id`),
  INDEX `idx_visit_date` (`visit_date`),
  INDEX `idx_status` (`status`)
);

-- 同行人员表
CREATE TABLE `companions` (
  `id` bigint PRIMARY KEY AUTO_INCREMENT,
  `reservation_id` bigint NOT NULL COMMENT '预约ID',
  `name` varchar(50) NOT NULL COMMENT '姓名',
  `id_card` varchar(18) NOT NULL COMMENT '身份证号',
  `phone` varchar(11) COMMENT '手机号',
  `relation` varchar(20) COMMENT '关系',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  INDEX `idx_reservation_id` (`reservation_id`)
);

-- 团体预约表
CREATE TABLE `group_reservations` (
  `id` bigint PRIMARY KEY AUTO_INCREMENT,
  `reservation_id` bigint NOT NULL COMMENT '预约ID',
  `group_name` varchar(100) NOT NULL COMMENT '团体名称',
  `group_type` varchar(20) NOT NULL COMMENT '团体类型',
  `leader_name` varchar(50) NOT NULL COMMENT '带队人姓名',
  `leader_phone` varchar(11) NOT NULL COMMENT '带队人电话',
  `leader_id_card` varchar(18) NOT NULL COMMENT '带队人身份证',
  `introduction_letter` varchar(255) COMMENT '介绍信文件路径',
  `member_list_file` varchar(255) COMMENT '成员名单文件路径',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  INDEX `idx_reservation_id` (`reservation_id`)
);

-- 时间段配置表
CREATE TABLE `time_slots` (
  `id` bigint PRIMARY KEY AUTO_INCREMENT,
  `slot_name` varchar(20) NOT NULL COMMENT '时间段名称',
  `start_time` time NOT NULL COMMENT '开始时间',
  `end_time` time NOT NULL COMMENT '结束时间',
  `capacity` int NOT NULL COMMENT '容量',
  `weekday_capacity` int COMMENT '工作日容量',
  `weekend_capacity` int COMMENT '周末容量',
  `is_active` tinyint DEFAULT 1 COMMENT '是否启用',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP
);

-- 博物馆配置表
CREATE TABLE `museum_config` (
  `id` bigint PRIMARY KEY AUTO_INCREMENT,
  `config_key` varchar(50) UNIQUE NOT NULL COMMENT '配置键',
  `config_value` text NOT NULL COMMENT '配置值',
  `description` varchar(200) COMMENT '描述',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- 系统日志表
CREATE TABLE `system_logs` (
  `id` bigint PRIMARY KEY AUTO_INCREMENT,
  `user_id` bigint COMMENT '用户ID',
  `action` varchar(50) NOT NULL COMMENT '操作类型',
  `resource` varchar(100) COMMENT '操作资源',
  `details` text COMMENT '操作详情',
  `ip_address` varchar(45) COMMENT 'IP地址',
  `user_agent` varchar(500) COMMENT '用户代理',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  INDEX `idx_user_id` (`user_id`),
  INDEX `idx_action` (`action`),
  INDEX `idx_created_at` (`created_at`)
);
```

## 3. 功能模块详细设计

### 3.1 用户管理模块

#### 3.1.1 用户注册与认证

```typescript
// 用户注册接口
interface UserRegistration {
  name: string;
  idCard: string;
  phone: string;
  email?: string;
  password: string;
  verificationCode: string;
}

// 身份证验证服务
class IdCardValidator {
  static validate(idCard: string): ValidationResult {
    // 身份证号码格式验证
    // 校验码验证
    // 年龄计算
    // 未成年人检查
  }
  
  static extractInfo(idCard: string): PersonInfo {
    // 提取生日、性别、地区信息
  }
}

// 实名认证组件
@Component
export class RealNameAuth {
  private authForm = reactive({
    name: '',
    idCard: '',
    phone: ''
  });
  
  private rules = {
    name: [{ required: true, message: '请输入真实姓名' }],
    idCard: [{ validator: this.validateIdCard }],
    phone: [{ pattern: /^1[3-9]\d{9}$/, message: '手机号格式不正确' }]
  };
  
  private async validateIdCard(rule: any, value: string, callback: Function) {
    const result = IdCardValidator.validate(value);
    if (!result.valid) {
      callback(new Error(result.message));
    } else {
      // 检查年龄限制
      const age = result.age;
      if (age < 14) {
        callback(new Error('14周岁以下儿童不能单独预约'));
      }
      callback();
    }
  }
}
```

#### 3.1.2 用户权限管理

```typescript
// 角色定义
enum UserRole {
  VISITOR = 'visitor',           // 普通游客
  GROUP_LEADER = 'group_leader', // 团体负责人
  STAFF = 'staff',               // 工作人员
  ADMIN = 'admin',               // 系统管理员
  SUPER_ADMIN = 'super_admin'    // 超级管理员
}

// 权限定义
enum Permission {
  // 预约相关
  RESERVATION_CREATE = 'reservation:create',
  RESERVATION_VIEW = 'reservation:view',
  RESERVATION_CANCEL = 'reservation:cancel',
  
  // 审批相关
  RESERVATION_AUDIT = 'reservation:audit',
  GROUP_AUDIT = 'group:audit',
  
  // 管理相关
  USER_MANAGE = 'user:manage',
  SYSTEM_CONFIG = 'system:config',
  DATA_EXPORT = 'data:export'
}

// 权限控制服务
class PermissionService {
  static hasPermission(user: User, permission: Permission): boolean {
    return user.permissions.includes(permission);
  }
  
  static checkRole(user: User, role: UserRole): boolean {
    return user.role === role;
  }
}
```

### 3.2 预约管理模块

#### 3.2.1 个人预约功能

```vue
<template>
  <div class="personal-reservation">
    <!-- 预约向导 -->
    <el-steps :active="currentStep" finish-status="success">
      <el-step title="身份验证"></el-step>
      <el-step title="选择时间"></el-step>
      <el-step title="添加同行人"></el-step>
      <el-step title="确认预约"></el-step>
    </el-steps>
    
    <!-- 步骤1: 身份验证 -->
    <div v-show="currentStep === 0" class="step-content">
      <real-name-auth 
        v-model="userInfo" 
        @validated="handleUserValidated"
      />
    </div>
    
    <!-- 步骤2: 时间选择 -->
    <div v-show="currentStep === 1" class="step-content">
      <time-slot-selector 
        v-model="selectedTimeSlot"
        :available-dates="availableDates"
        @change="handleTimeSlotChange"
      />
    </div>
    
    <!-- 步骤3: 同行人员 -->
    <div v-show="currentStep === 2" class="step-content">
      <companion-manager 
        v-model="companions"
        :max-count="4"
        @change="handleCompanionsChange"
      />
    </div>
    
    <!-- 步骤4: 确认预约 -->
    <div v-show="currentStep === 3" class="step-content">
      <reservation-summary 
        :user-info="userInfo"
        :time-slot="selectedTimeSlot"
        :companions="companions"
        @confirm="handleConfirmReservation"
      />
    </div>
    
    <!-- 操作按钮 -->
    <div class="step-actions">
      <el-button 
        v-if="currentStep > 0" 
        @click="prevStep"
      >
        上一步
      </el-button>
      <el-button 
        v-if="currentStep < 3" 
        type="primary" 
        @click="nextStep"
        :disabled="!canProceed"
      >
        下一步
      </el-button>
      <el-button 
        v-if="currentStep === 3" 
        type="primary" 
        @click="submitReservation"
        :loading="submitting"
      >
        提交预约
      </el-button>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, computed } from 'vue';
import { useReservationStore } from '@/stores/reservation';
import { ElMessage } from 'element-plus';

const reservationStore = useReservationStore();
const currentStep = ref(0);
const submitting = ref(false);

const userInfo = ref({
  name: '',
  idCard: '',
  phone: ''
});

const selectedTimeSlot = ref({
  date: '',
  slot: '',
  capacity: 0,
  remaining: 0
});

const companions = ref([]);

const canProceed = computed(() => {
  switch (currentStep.value) {
    case 0:
      return userInfo.value.name && userInfo.value.idCard && userInfo.value.phone;
    case 1:
      return selectedTimeSlot.value.date && selectedTimeSlot.value.slot;
    case 2:
      return true; // 同行人员可选
    default:
      return false;
  }
});

const availableDates = computed(() => {
  // 计算可预约日期（每周二9点放本周四五六的号）
  const dates = [];
  const now = new Date();
  const dayOfWeek = now.getDay();
  
  // 如果是周二且时间在9点后，可以预约本周四五六
  if (dayOfWeek === 2 && now.getHours() >= 9) {
    const thursday = new Date(now);
    thursday.setDate(now.getDate() + 2);
    dates.push(thursday);
    
    const friday = new Date(now);
    friday.setDate(now.getDate() + 3);
    dates.push(friday);
    
    const saturday = new Date(now);
    saturday.setDate(now.getDate() + 4);
    dates.push(saturday);
  }
  
  return dates;
});

const handleUserValidated = (validated: boolean) => {
  if (validated) {
    // 检查用户是否在黑名单
    checkBlacklistStatus();
  }
};

const checkBlacklistStatus = async () => {
  try {
    const result = await reservationStore.checkBlacklistStatus(userInfo.value.idCard);
    if (result.isBlacklisted) {
      ElMessage.error(`您已被列入失信名单，解除时间：${result.releaseDate}`);
      return;
    }
  } catch (error) {
    ElMessage.error('验证失败，请重试');
  }
};

const handleTimeSlotChange = (timeSlot: any) => {
  // 检查时间段容量
  if (timeSlot.remaining < 1 + companions.value.length) {
    ElMessage.warning('所选时间段剩余名额不足');
  }
};

const handleCompanionsChange = (newCompanions: any[]) => {
  // 验证同行人员身份证
  newCompanions.forEach(companion => {
    const validation = IdCardValidator.validate(companion.idCard);
    if (!validation.valid) {
      ElMessage.error(`${companion.name}的身份证号码格式不正确`);
    }
  });
};

const submitReservation = async () => {
  submitting.value = true;
  try {
    const reservationData = {
      userInfo: userInfo.value,
      timeSlot: selectedTimeSlot.value,
      companions: companions.value,
      type: 'personal'
    };
    
    const result = await reservationStore.createReservation(reservationData);
    ElMessage.success('预约提交成功，请等待审核');
    
    // 跳转到预约详情页
    router.push(`/reservation/${result.reservationNo}`);
  } catch (error) {
    ElMessage.error('预约提交失败，请重试');
  } finally {
    submitting.value = false;
  }
};
</script>
```

#### 3.2.2 团体预约功能

```vue
<template>
  <div class="group-reservation">
    <el-form :model="groupForm" :rules="groupRules" ref="formRef">
      <!-- 团体基本信息 -->
      <el-card title="团体信息">
        <el-form-item label="团体类型" prop="type">
          <el-select v-model="groupForm.type" @change="handleTypeChange">
            <el-option label="学校团体" value="school">
              <template #default>
                <div>
                  <span>学校团体</span>
                  <div class="option-desc">中小学、大学等教育机构</div>
                </div>
              </template>
            </el-option>
            <el-option label="企业团体" value="company">
              <template #default>
                <div>
                  <span>企业团体</span>
                  <div class="option-desc">公司、企业等商业机构</div>
                </div>
              </template>
            </el-option>
            <el-option label="社会团体" value="social">
              <template #default>
                <div>
                  <span>社会团体</span>
                  <div class="option-desc">协会、俱乐部等社会组织</div>
                </div>
              </template>
            </el-option>
          </el-select>
        </el-form-item>
        
        <el-form-item label="团体名称" prop="name">
          <el-input v-model="groupForm.name" placeholder="请输入完整的团体名称"/>
        </el-form-item>
        
        <el-form-item label="参观人数" prop="memberCount">
          <el-input-number 
            v-model="groupForm.memberCount" 
            :min="10" 
            :max="200"
            @change="handleMemberCountChange"
          />
          <div class="form-tip">团体预约最少10人，最多200人</div>
        </el-form-item>
        
        <el-form-item label="参观日期" prop="visitDate">
          <el-date-picker 
            v-model="groupForm.visitDate"
            type="date"
            :disabled-date="disabledDate"
            @change="checkDateAvailability"
          />
        </el-form-item>
        
        <el-form-item label="时间段" prop="timeSlot">
          <el-select v-model="groupForm.timeSlot" :disabled="!groupForm.visitDate">
            <el-option 
              v-for="slot in availableTimeSlots"
              :key="slot.value"
              :label="`${slot.label} (可容纳${slot.capacity}人)`"
              :value="slot.value"
              :disabled="slot.capacity < groupForm.memberCount"
            />
          </el-select>
        </el-form-item>
      </el-card>
      
      <!-- 带队人信息 -->
      <el-card title="带队人信息">
        <el-form-item label="带队人姓名" prop="leaderName">
          <el-input v-model="groupForm.leaderName"/>
        </el-form-item>
        
        <el-form-item label="身份证号" prop="leaderIdCard">
          <el-input v-model="groupForm.leaderIdCard" @blur="validateLeaderIdCard"/>
        </el-form-item>
        
        <el-form-item label="联系电话" prop="leaderPhone">
          <el-input v-model="groupForm.leaderPhone"/>
        </el-form-item>
        
        <el-form-item label="职务/关系" prop="leaderRole">
          <el-input v-model="groupForm.leaderRole" placeholder="如：班主任、领队等"/>
        </el-form-item>
      </el-card>
      
      <!-- 成员信息 -->
      <el-card title="成员信息">
        <el-tabs v-model="memberInputMethod">
          <el-tab-pane label="Excel批量导入" name="excel">
            <div class="upload-section">
              <el-upload
                :action="uploadUrl"
                :before-upload="beforeUpload"
                :on-success="handleUploadSuccess"
                :on-error="handleUploadError"
                accept=".xlsx,.xls"
                :limit="1"
              >
                <el-button type="primary" icon="el-icon-upload">
                  上传Excel文件
                </el-button>
              </el-upload>
              
              <div class="upload-tips">
                <p>请按照模板格式填写成员信息：</p>
                <ul>
                  <li>姓名、身份证号为必填项</li>
                  <li>身份证号格式必须正确</li>
                  <li>文件大小不超过5MB</li>
                </ul>
                <el-link type="primary" @click="downloadTemplate">
                  下载Excel模板
                </el-link>
              </div>
            </div>
            
            <!-- 导入结果预览 -->
            <div v-if="importedMembers.length > 0" class="import-preview">
              <h4>导入预览 (共{{ importedMembers.length }}人)</h4>
              <el-table :data="importedMembers" max-height="300">
                <el-table-column prop="name" label="姓名" width="120"/>
                <el-table-column prop="idCard" label="身份证号" width="180"/>
                <el-table-column prop="phone" label="手机号" width="120"/>
                <el-table-column prop="status" label="验证状态" width="100">
                  <template #default="scope">
                    <el-tag :type="scope.row.status === 'valid' ? 'success' : 'danger'">
                      {{ scope.row.status === 'valid' ? '有效' : '无效' }}
                    </el-tag>
                  </template>
                </el-table-column>
                <el-table-column prop="error" label="错误信息" show-overflow-tooltip/>
              </el-table>
            </div>
          </el-tab-pane>
          
          <el-tab-pane label="手动添加" name="manual">
            <div class="manual-input">
              <div v-for="(member, index) in manualMembers" :key="index" class="member-item">
                <el-form :model="member" inline>
                  <el-form-item label="姓名">
                    <el-input v-model="member.name" style="width: 120px;"/>
                  </el-form-item>
                  <el-form-item label="身份证号">
                    <el-input v-model="member.idCard" style="width: 180px;"/>
                  </el-form-item>
                  <el-form-item label="手机号">
                    <el-input v-model="member.phone" style="width: 120px;"/>
                  </el-form-item>
                  <el-form-item>
                    <el-button type="danger" @click="removeMember(index)">
                      删除
                    </el-button>
                  </el-form-item>
                </el-form>
              </div>
              
              <el-button @click="addMember" :disabled="manualMembers.length >= 200">
                添加成员
              </el-button>
            </div>
          </el-tab-pane>
        </el-tabs>
      </el-card>
      
      <!-- 单位介绍信 -->
      <el-card title="单位介绍信">
        <el-form-item label="介绍信" prop="introductionLetter">
          <el-upload
            :action="uploadUrl"
            :before-upload="beforeLetterUpload"
            :on-success="handleLetterSuccess"
            accept=".jpg,.jpeg,.png,.pdf"
            :limit="1"
            list-type="picture-card"
          >
            <el-icon><Plus /></el-icon>
          </el-upload>
          <div class="upload-tips">
            <p>请上传单位介绍信：</p>
            <ul>
              <li>支持JPG、PNG、PDF格式</li>
              <li>文件大小不超过10MB</li>
              <li>图片清晰，内容完整</li>
            </ul>
          </div>
        </el-form-item>
      </el-card>
      
      <!-- 提交按钮 -->
      <div class="form-actions">
        <el-button @click="resetForm">重置</el-button>
        <el-button type="primary" @click="submitForm" :loading="submitting">
          提交团体预约
        </el-button>
      </div>
    </el-form>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, computed } from 'vue';
import { ElMessage, ElMessageBox } from 'element-plus';
import { Plus } from '@element-plus/icons-vue';
import * as XLSX from 'xlsx';

const formRef = ref();
const submitting = ref(false);
const memberInputMethod = ref('excel');

const groupForm = reactive({
  type: '',
  name: '',
  memberCount: 10,
  visitDate: '',
  timeSlot: '',
  leaderName: '',
  leaderIdCard: '',
  leaderPhone: '',
  leaderRole: '',
  introductionLetter: ''
});

const groupRules = {
  type: [{ required: true, message: '请选择团体类型' }],
  name: [{ required: true, message: '请输入团体名称' }],
  memberCount: [{ required: true, message: '请输入参观人数' }],
  visitDate: [{ required: true, message: '请选择参观日期' }],
  timeSlot: [{ required: true, message: '请选择时间段' }],
  leaderName: [{ required: true, message: '请输入带队人姓名' }],
  leaderIdCard: [{ required: true, validator: validateIdCard }],
  leaderPhone: [{ required: true, pattern: /^1[3-9]\d{9}$/, message: '手机号格式不正确' }]
};

const importedMembers = ref([]);
const manualMembers = ref([{ name: '', idCard: '', phone: '' }]);

const availableTimeSlots = computed(() => {
  // 根据选择的日期和人数计算可用时间段
  if (!groupForm.visitDate) return [];
  
  return [
    { value: '09:00-10:00', label: '9:00-10:00', capacity: 100 },
    { value: '10:00-11:00', label: '10:00-11:00', capacity: 150 },
    { value: '11:00-12:00', label: '11:00-12:00', capacity: 150 },
    { value: '13:00-14:00', label: '13:00-14:00', capacity: 100 },
    { value: '14:00-15:30', label: '14:00-15:30', capacity: 150 }
  ];
});

const uploadUrl = computed(() => {
  return `${import.meta.env.VITE_API_BASE_URL}/upload/excel`;
});

function validateIdCard(rule: any, value: string, callback: Function) {
  const result = IdCardValidator.validate(value);
  if (!result.valid) {
    callback(new Error(result.message));
  } else {
    callback();
  }
}

function disabledDate(date: Date): boolean {
  // 只能预约未来7-30天的日期
  const today = new Date();
  const minDate = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
  const maxDate = new Date(today.getTime() + 30 * 24 * 60 * 60 * 1000);
  
  return date < minDate || date > maxDate;
}

function handleTypeChange(type: string) {
  // 根据团体类型调整相关配置
  if (type === 'school') {
    groupForm.leaderRole = '带队老师';
  } else if (type === 'company') {
    groupForm.leaderRole = '团队负责人';
  }
}

function handleMemberCountChange(count: number) {
  // 检查时间段容量
  if (groupForm.timeSlot) {
    const slot = availableTimeSlots.value.find(s => s.value === groupForm.timeSlot);
    if (slot && count > slot.capacity) {
      ElMessage.warning(`所选时间段最多容纳${slot.capacity}人`);
    }
  }
}

function beforeUpload(file: File): boolean {
  const isExcel = file.type === 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' ||
                  file.type === 'application/vnd.ms-excel';
  const isLt5M = file.size / 1024 / 1024 < 5;
  
  if (!isExcel) {
    ElMessage.error('只能上传Excel文件');
    return false;
  }
  if (!isLt5M) {
    ElMessage.error('文件大小不能超过5MB');
    return false;
  }
  
  // 客户端解析Excel
  const reader = new FileReader();
  reader.onload = (e) => {
    const data = new Uint8Array(e.target?.result as ArrayBuffer);
    const workbook = XLSX.read(data, { type: 'array' });
    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
    const jsonData = XLSX.utils.sheet_to_json(worksheet);
    
    parseExcelData(jsonData);
  };
  reader.readAsArrayBuffer(file);
  
  return false; // 阻止自动上传
}

function parseExcelData(data: any[]) {
  const members = data.map((row, index) => {
    const member = {
      name: row['姓名'] || '',
      idCard: row['身份证号'] || '',
      phone: row['手机号'] || '',
      status: 'valid',
      error: ''
    };
    
    // 验证数据
    if (!member.name) {
      member.status = 'invalid';
      member.error = '姓名不能为空';
    } else if (!member.idCard) {
      member.status = 'invalid';
      member.error = '身份证号不能为空';
    } else {
      const validation = IdCardValidator.validate(member.idCard);
      if (!validation.valid) {
        member.status = 'invalid';
        member.error = validation.message;
      }
    }
    
    return member;
  });
  
  importedMembers.value = members;
  
  const validCount = members.filter(m => m.status === 'valid').length;
  const invalidCount = members.length - validCount;
  
  if (invalidCount > 0) {
    ElMessage.warning(`导入完成，有效数据${validCount}条，无效数据${invalidCount}条`);
  } else {
    ElMessage.success(`导入成功，共${validCount}条有效数据`);
  }
}

function downloadTemplate() {
  // 下载Excel模板
  const link = document.createElement('a');
  link.href = '/templates/group-members-template.xlsx';
  link.download = '团体成员信息模板.xlsx';
  link.click();
}

function addMember() {
  manualMembers.value.push({ name: '', idCard: '', phone: '' });
}

function removeMember(index: number) {
  manualMembers.value.splice(index, 1);
}

function submitForm() {
  formRef.value.validate(async (valid: boolean) => {
    if (!valid) return;
    
    // 检查成员信息
    const members = memberInputMethod.value === 'excel' 
      ? importedMembers.value.filter(m => m.status === 'valid')
      : manualMembers.value.filter(m => m.name && m.idCard);
    
    if (members.length !== groupForm.memberCount) {
      ElMessage.error(`成员信息数量(${members.length})与预约人数(${groupForm.memberCount})不符`);
      return;
    }
    
    submitting.value = true;
    try {
      const reservationData = {
        ...groupForm,
        members,
        type: 'group'
      };
      
      const result = await groupReservationStore.createReservation(reservationData);
      ElMessage.success('团体预约提交成功，请等待审核');
      
      // 跳转到预约详情页
      router.push(`/group-reservation/${result.reservationNo}`);
    } catch (error) {
      ElMessage.error('预约提交失败，请重试');
    } finally {
      submitting.value = false;
    }
  });
}
</script>
```

### 3.3 数据统计与分析模块

#### 3.3.1 实时数据大屏

```vue
<template>
  <div class="data-dashboard">
    <!-- 顶部统计卡片 -->
    <div class="stats-cards">
      <div class="stat-card">
        <div class="stat-icon">
          <el-icon><Calendar /></el-icon>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ todayStats.reservations }}</div>
          <div class="stat-label">今日预约</div>
          <div class="stat-trend" :class="todayStats.reservationsTrend > 0 ? 'up' : 'down'">
            <el-icon><ArrowUp v-if="todayStats.reservationsTrend > 0" /><ArrowDown v-else /></el-icon>
            {{ Math.abs(todayStats.reservationsTrend) }}%
          </div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <el-icon><User /></el-icon>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ todayStats.visitors }}</div>
          <div class="stat-label">今日入馆</div>
          <div class="stat-trend" :class="todayStats.visitorsTrend > 0 ? 'up' : 'down'">
            <el-icon><ArrowUp v-if="todayStats.visitorsTrend > 0" /><ArrowDown v-else /></el-icon>
            {{ Math.abs(todayStats.visitorsTrend) }}%
          </div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <el-icon><PieChart /></el-icon>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ todayStats.utilization }}%</div>
          <div class="stat-label">今日利用率</div>
          <div class="stat-trend" :class="todayStats.utilizationTrend > 0 ? 'up' : 'down'">
            <el-icon><ArrowUp v-if="todayStats.utilizationTrend > 0" /><ArrowDown v-else /></el-icon>
            {{ Math.abs(todayStats.utilizationTrend) }}%
          </div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-icon">
          <el-icon><Warning /></el-icon>
        </div>
        <div class="stat-content">
          <div class="stat-number">{{ todayStats.blacklist }}</div>
          <div class="stat-label">失信人员</div>
          <div class="stat-trend" :class="todayStats.blacklistTrend > 0 ? 'up' : 'down'">
            <el-icon><ArrowUp v-if="todayStats.blacklistTrend > 0" /><ArrowDown v-else /></el-icon>
            {{ Math.abs(todayStats.blacklistTrend) }}%
          </div>
        </div>
      </div>
    </div>
    
    <!-- 图表区域 -->
    <div class="charts-grid">
      <!-- 预约趋势图 -->
      <div class="chart-container">
        <div class="chart-header">
          <h3>预约趋势分析</h3>
          <el-radio-group v-model="trendPeriod" @change="updateTrendChart">
            <el-radio-button label="7d">近7天</el-radio-button>
            <el-radio-button label="30d">近30天</el-radio-button>
            <el-radio-button label="90d">近3个月</el-radio-button>
          </el-radio-group>
        </div>
        <v-chart :option="trendChartOption" style="height: 350px;" />
      </div>
      
      <!-- 时间段分布 -->
      <div class="chart-container">
        <div class="chart-header">
          <h3>时间段预约分布</h3>
          <el-date-picker 
            v-model="timeSlotDate" 
            type="date" 
            @change="updateTimeSlotChart"
          />
        </div>
        <v-chart :option="timeSlotChartOption" style="height: 350px;" />
      </div>
      
      <!-- 年龄段分析 -->
      <div class="chart-container">
        <div class="chart-header">
          <h3>游客年龄段分布</h3>
          <el-select v-model="agePeriod" @change="updateAgeChart">
            <el-option label="本周" value="week" />
            <el-option label="本月" value="month" />
            <el-option label="本年" value="year" />
          </el-select>
        </div>
        <v-chart :option="ageChartOption" style="height: 350px;" />
      </div>
      
      <!-- 预约类型占比 -->
      <div class="chart-container">
        <div class="chart-header">
          <h3>预约类型分析</h3>
          <el-select v-model="typePeriod" @change="updateTypeChart">
            <el-option label="本周" value="week" />
            <el-option label="本月" value="month" />
            <el-option label="本年" value="year" />
          </el-select>
        </div>
        <v-chart :option="typeChartOption" style="height: 350px;" />
      </div>
      
      <!-- 地区分布 -->
      <div class="chart-container">
        <div class="chart-header">
          <h3>游客地区分布</h3>
          <el-select v-model="regionPeriod" @change="updateRegionChart">
            <el-option label="本月" value="month" />
            <el-option label="本年" value="year" />
          </el-select>
        </div>
        <v-chart :option="regionChartOption" style="height: 350px;" />
      </div>
      
      <!-- 满意度统计 -->
      <div class="chart-container">
        <div class="chart-header">
          <h3>游客满意度评价</h3>
          <el-select v-model="satisfactionPeriod" @change="updateSatisfactionChart">
            <el-option label="本月" value="month" />
            <el-option label="本季度" value="quarter" />
            <el-option label="本年" value="year" />
          </el-select>
        </div>
        <v-chart :option="satisfactionChartOption" style="height: 350px;" />
      </div>
    </div>
    
    <!-- 实时数据表格 -->
    <div class="real-time-data">
      <el-card title="实时预约数据">
        <el-table :data="realtimeReservations" style="width: 100%">
          <el-table-column prop="time" label="时间" width="120" />
          <el-table-column prop="name" label="游客姓名" width="120" />
          <el-table-column prop="type" label="预约类型" width="100">
            <template #default="scope">
              <el-tag :type="scope.row.type === 'personal' ? 'primary' : 'success'">
                {{ scope.row.type === 'personal' ? '个人' : '团体' }}
              </el-tag>
            </template>
          </el-table-column>
          <el-table-column prop="visitDate" label="参观日期" width="120" />
          <el-table-column prop="timeSlot" label="时间段" width="120" />
          <el-table-column prop="visitorCount" label="人数" width="80" />
          <el-table-column prop="status" label="状态" width="100">
            <template #default="scope">
              <el-tag :type="getStatusType(scope.row.status)">
                {{ getStatusText(scope.row.status) }}
              </el-tag>
            </template>
          </el-table-column>
        </el-table>
      </el-card>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive, onMounted, onUnmounted } from 'vue';
import { use } from 'echarts/core';
import { CanvasRenderer } from 'echarts/renderers';
import { LineChart, BarChart, PieChart, MapChart } from 'echarts/charts';
import {
  TitleComponent,
  TooltipComponent,
  LegendComponent,
  GridComponent,
  DataZoomComponent
} from 'echarts/components';
import VChart from 'vue-echarts';

use([
  CanvasRenderer,
  LineChart,
  BarChart,
  PieChart,
  MapChart,
  TitleComponent,
  TooltipComponent,
  LegendComponent,
  GridComponent,
  DataZoomComponent
]);

const todayStats = reactive({
  reservations: 0,
  reservationsTrend: 0,
  visitors: 0,
  visitorsTrend: 0,
  utilization: 0,
  utilizationTrend: 0,
  blacklist: 0,
  blacklistTrend: 0
});

const trendPeriod = ref('7d');
const timeSlotDate = ref(new Date());
const agePeriod = ref('month');
const typePeriod = ref('month');
const regionPeriod = ref('month');
const satisfactionPeriod = ref('month');

const realtimeReservations = ref([]);
let websocket: WebSocket | null = null;

// 图表配置
const trendChartOption = ref({
  title: {
    text: '预约趋势'
  },
  tooltip: {
    trigger: 'axis'
  },
  legend: {
    data: ['个人预约', '团体预约', '总预约']
  },
  xAxis: {
    type: 'category',
    data: []
  },
  yAxis: {
    type: 'value'
  },
  series: [
    {
      name: '个人预约',
      type: 'line',
      data: []
    },
    {
      name: '团体预约',
      type: 'line',
      data: []
    },
    {
      name: '总预约',
      type: 'line',
      data: []
    }
  ]
});

const timeSlotChartOption = ref({
  title: {
    text: '时间段预约分布'
  },
  tooltip: {
    trigger: 'axis'
  },
  xAxis: {
    type: 'category',
    data: ['9:00-10:00', '10:00-11:00', '11:00-12:00', '12:00-13:00', '13:00-14:00', '14:00-15:30']
  },
  yAxis: {
    type: 'value'
  },
  series: [
    {
      name: '预约人数',
      type: 'bar',
      data: [],
      itemStyle: {
        color: '#409EFF'
      }
    },
    {
      name: '容量',
      type: 'line',
      data: [100, 150, 150, 100, 100, 150],
      itemStyle: {
        color: '#E6A23C'
      }
    }
  ]
});

const ageChartOption = ref({
  title: {
    text: '年龄段分布'
  },
  tooltip: {
    trigger: 'item'
  },
  series: [
    {
      name: '年龄段',
      type: 'pie',
      radius: '50%',
      data: [
        { value: 0, name: '未成年人(0-17岁)' },
        { value: 0, name: '青年人(18-35岁)' },
        { value: 0, name: '中年人(36-59岁)' },
        { value: 0, name: '老年人(60岁以上)' }
      ]
    }
  ]
});

const typeChartOption = ref({
  title: {
    text: '预约类型占比'
  },
  tooltip: {
    trigger: 'item'
  },
  series: [
    {
      name: '预约类型',
      type: 'pie',
      radius: ['40%', '70%'],
      data: [
        { value: 0, name: '个人预约' },
        { value: 0, name: '团体预约' }
      ]
    }
  ]
});

const regionChartOption = ref({
  title: {
    text: '游客地区分布'
  },
  tooltip: {
    trigger: 'item'
  },
  series: [
    {
      name: '地区',
      type: 'pie',
      radius: '50%',
      data: []
    }
  ]
});

const satisfactionChartOption = ref({
  title: {
    text: '满意度评价'
  },
  tooltip: {
    trigger: 'axis'
  },
  xAxis: {
    type: 'category',
    data: ['非常满意', '满意', '一般', '不满意', '非常不满意']
  },
  yAxis: {
    type: 'value'
  },
  series: [
    {
      name: '评价数量',
      type: 'bar',
      data: []
    }
  ]
});

onMounted(() => {
  initWebSocket();
  loadDashboardData();
  
  // 定时刷新数据
  setInterval(loadDashboardData, 30000); // 30秒刷新一次
});

onUnmounted(() => {
  if (websocket) {
    websocket.close();
  }
});

function initWebSocket() {
  const wsUrl = `ws://${location.host}/ws/dashboard`;
  websocket = new WebSocket(wsUrl);
  
  websocket.onmessage = (event) => {
    const data = JSON.parse(event.data);
    handleRealtimeData(data);
  };
  
  websocket.onerror = (error) => {
    console.error('WebSocket error:', error);
  };
}

function handleRealtimeData(data: any) {
  if (data.type === 'new_reservation') {
    realtimeReservations.value.unshift(data.reservation);
    if (realtimeReservations.value.length > 50) {
      realtimeReservations.value.pop();
    }
    
    // 更新统计数据
    todayStats.reservations++;
  } else if (data.type === 'visitor_checkin') {
    todayStats.visitors++;
  }
}

async function loadDashboardData() {
  try {
    const response = await fetch('/api/dashboard/stats');
    const data = await response.json();
    
    Object.assign(todayStats, data.todayStats);
    updateAllCharts(data.chartData);
  } catch (error) {
    console.error('Failed to load dashboard data:', error);
  }
}

function updateAllCharts(chartData: any) {
  updateTrendChart(chartData.trend);
  updateTimeSlotChart(chartData.timeSlot);
  updateAgeChart(chartData.age);
  updateTypeChart(chartData.type);
  updateRegionChart(chartData.region);
  updateSatisfactionChart(chartData.satisfaction);
}

function updateTrendChart(data?: any) {
  // 更新趋势图数据
  if (data) {
    trendChartOption.value.xAxis.data = data.dates;
    trendChartOption.value.series[0].data = data.personal;
    trendChartOption.value.series[1].data = data.group;
    trendChartOption.value.series[2].data = data.total;
  }
}

function updateTimeSlotChart(data?: any) {
  // 更新时间段图数据
  if (data) {
    timeSlotChartOption.value.series[0].data = data.reservations;
  }
}

function updateAgeChart(data?: any) {
  // 更新年龄段图数据
  if (data) {
    ageChartOption.value.series[0].data = data;
  }
}

function updateTypeChart(data?: any) {
  // 更新类型图数据
  if (data) {
    typeChartOption.value.series[0].data = data;
  }
}

function updateRegionChart(data?: any) {
  // 更新地区图数据
  if (data) {
    regionChartOption.value.series[0].data = data;
  }
}

function updateSatisfactionChart(data?: any) {
  // 更新满意度图数据
  if (data) {
    satisfactionChartOption.value.series[0].data = data;
  }
}

function getStatusType(status: string): string {
  const statusMap: Record<string, string> = {
    'pending': 'warning',
    'approved': 'success',
    'rejected': 'danger',
    'cancelled': 'info',
    'completed': 'success'
  };
  return statusMap[status] || 'info';
}

function getStatusText(status: string): string {
  const statusMap: Record<string, string> = {
    'pending': '待审核',
    'approved': '已通过',
    'rejected': '已拒绝',
    'cancelled': '已取消',
    'completed': '已完成'
  };
  return statusMap[status] || '未知';
}
</script>
```

## 4. 开发计划与里程碑

### 4.1 项目阶段划分

#### 第一阶段：项目初始化 (3-4天)
- 项目架构搭建
- 开发环境配置
- 基础框架集成
- 数据库设计与创建
- CI/CD流水线搭建

#### 第二阶段：核心功能开发 (12-15天)
- 用户认证与权限系统
- 个人预约功能
- 团体预约功能
- 预约审批流程
- 基础管理功能

#### 第三阶段：高级功能开发 (8-10天)
- 数据统计与分析
- 实时通知系统
- 二维码生成与验证
- 文件上传与处理
- 移动端适配

#### 第四阶段：系统集成与测试 (5-7天)
- 功能集成测试
- 性能压力测试
- 安全性测试
- 用户体验测试
- Bug修复与优化

#### 第五阶段：部署与上线 (2-3天)
- 生产环境部署
- 数据迁移
- 系统监控配置
- 用户培训
- 正式上线

### 4.2 详细开发计划

| 周次 | 主要任务 | 交付物 | 负责人 |
|------|---------|--------|--------|
| 第1周 | 项目初始化、架构搭建 | 项目框架、数据库设计 | 架构师+后端 |
| 第2周 | 用户系统、认证模块 | 登录注册、权限管理 | 全栈开发 |
| 第3周 | 个人预约功能 | 预约流程、表单验证 | 前端+后端 |
| 第4周 | 团体预约功能 | 团体预约、文件上传 | 前端+后端 |
| 第5周 | 管理后台、审批流程 | 审批系统、管理界面 | 全栈开发 |
| 第6周 | 数据统计、报表功能 | 统计图表、数据分析 | 前端+后端 |
| 第7周 | 系统集成、功能测试 | 完整系统、测试报告 | 测试工程师 |
| 第8周 | 部署上线、用户培训 | 生产系统、培训文档 | 运维+产品 |

### 4.3 关键里程碑

#### 里程碑1：架构完成 (第1周末)
- **验收标准**：
  - 项目框架搭建完成
  - 数据库设计通过评审
  - 开发环境配置完成
  - CI/CD流水线可用

#### 里程碑2：核心功能完成 (第4周末)
- **验收标准**：
  - 用户注册登录功能正常
  - 个人预约流程完整
  - 团体预约功能可用
  - 基础管理功能实现

#### 里程碑3：系统功能完整 (第6周末)
- **验收标准**：
  - 所有功能模块开发完成
  - 数据统计功能正常
  - 系统集成测试通过
  - 性能指标达标

#### 里程碑4：系统上线 (第8周末)
- **验收标准**：
  - 生产环境部署成功
  - 用户验收测试通过
  - 系统监控正常
  - 用户培训完成

## 5. 成本效益分析

### 5.1 开发成本详细分析

#### 人力成本
```
项目经理 (1人 × 8周 × 5天/周 × 8小时/天) = 320小时
架构师 (1人 × 2周 × 5天/周 × 8小时/天) = 80小时
前端开发 (2人 × 6周 × 5天/周 × 8小时/天) = 480小时
后端开发 (2人 × 6周 × 5天/周 × 8小时/天) = 480小时
UI/UX设计师 (1人 × 3周 × 5天/周 × 8小时/天) = 120小时
测试工程师 (1人 × 4周 × 5天/周 × 8小时/天) = 160小时
运维工程师 (1人 × 2周 × 5天/周 × 8小时/天) = 80小时

总计：1720小时
```

#### 技术成本
```
开发工具许可证：¥50,000
云服务器费用：¥30,000/年
数据库许可证：¥40,000
第三方服务费用：¥20,000
域名SSL证书：¥5,000

总计：¥145,000
```

#### 总成本估算
```
人力成本：1720小时 × ¥500/小时 = ¥860,000
技术成本：¥145,000
管理成本：¥100,000
风险预留：¥200,000

项目总成本：¥1,305,000
```

### 5.2 与改造方案成本对比

| 成本项目 | 重新开发 | 改造方案 | 差额 |
|---------|---------|---------|------|
| 开发时间 | 8周 | 3周 | +5周 |
| 人力成本 | ¥860,000 | ¥300,000 | +¥560,000 |
| 技术成本 | ¥145,000 | ¥50,000 | +¥95,000 |
| 风险成本 | ¥200,000 | ¥50,000 | +¥150,000 |
| **总成本** | **¥1,305,000** | **¥450,000** | **+¥855,000** |

### 5.3 长期效益分析

#### 重新开发的优势
1. **技术先进性**：使用最新技术栈，系统性能更优
2. **架构合理性**：专门为博物馆业务设计，扩展性更强
3. **维护成本低**：代码质量高，后期维护成本较低
4. **安全性高**：从零开始设计安全架构，安全性更有保障

#### 5年总拥有成本对比

| 成本项目 | 重新开发 | 改造方案 |
|---------|---------|----------|
| 初始开发 | ¥1,305,000 | ¥450,000 |
| 年度维护 | ¥100,000 | ¥150,000 |
| 功能升级 | ¥200,000 | ¥300,000 |
| 安全更新 | ¥50,000 | ¥80,000 |
| **5年总计** | **¥2,055,000** | **¥2,100,000** |

## 6. 风险评估与控制

### 6.1 技术风险

#### 高风险项
1. **新技术学习曲线**
   - 风险描述：团队对新技术栈不熟悉
   - 影响程度：可能延期2-3周
   - 控制措施：提前技术培训，引入技术专家

2. **第三方服务集成**
   - 风险描述：第三方API不稳定或变更
   - 影响程度：功能受限或需要重新开发
   - 控制措施：选择稳定的服务商，准备备选方案

#### 中风险项
1. **性能优化挑战**
   - 风险描述：高并发场景下性能不达标
   - 影响程度：用户体验差，需要架构调整
   - 控制措施：早期性能测试，分阶段优化

2. **数据安全合规**
   - 风险描述：个人信息保护法规要求
   - 影响程度：可能需要重新设计数据处理流程
   - 控制措施：咨询法务专家，遵循最佳实践

### 6.2 项目风险

#### 高风险项
1. **需求变更频繁**
   - 风险描述：客户需求不明确或频繁变更
   - 影响程度：项目延期，成本增加
   - 控制措施：详细需求分析，变更控制流程

2. **关键人员离职**
   - 风险描述：核心开发人员中途离职
   - 影响程度：项目进度严重受影响
   - 控制措施：知识文档化，交叉培训

#### 中风险项
1. **测试时间不足**
   - 风险描述：开发延期导致测试时间压缩
   - 影响程度：系统质量无法保证
   - 控制措施：并行开发测试，自动化测试

### 6.3 业务风险

#### 中风险项
1. **用户接受度低**
   - 风险描述：新系统操作复杂，用户不适应
   - 影响程度：系统使用率低，投资回报差
   - 控制措施：用户体验设计，充分培训

2. **竞争对手抢先**
   - 风险描述：其他博物馆率先推出类似系统
   - 影响程度：失去先发优势
   - 控制措施：加快开发进度，突出特色功能

### 6.4 风险控制策略

#### 技术风险控制
1. **技术选型谨慎**：选择成熟稳定的技术栈
2. **原型验证**：关键功能先做原型验证
3. **代码审查**：建立严格的代码审查机制
4. **自动化测试**：建立完善的自动化测试体系

#### 项目风险控制
1. **敏捷开发**：采用敏捷开发方法，快速迭代
2. **里程碑管理**：设置明确的里程碑和检查点
3. **沟通机制**：建立定期沟通和汇报机制
4. **应急预案**：制定各种风险的应急处理预案

## 7. 质量保证体系

### 7.1 代码质量标准

#### 编码规范
```typescript
// TypeScript编码规范示例
interface UserInfo {
  readonly id: number;
  name: string;
  email: string;
  createdAt: Date;
}

class UserService {
  private readonly apiClient: ApiClient;
  
  constructor(apiClient: ApiClient) {
    this.apiClient = apiClient;
  }
  
  async getUserById(id: number): Promise<UserInfo | null> {
    try {
      const response = await this.apiClient.get(`/users/${id}`);
      return response.data;
    } catch (error) {
      console.error('Failed to fetch user:', error);
      return null;
    }
  }
}
```

#### 代码审查清单
- [ ] 代码符合团队编码规范
- [ ] 函数和类的职责单一
- [ ] 错误处理完善
- [ ] 单元测试覆盖率达到80%以上
- [ ] 性能关键路径已优化
- [ ] 安全漏洞已检查
- [ ] 文档注释完整

### 7.2 测试策略

#### 测试金字塔
```
        E2E测试 (10%)
      ┌─────────────────┐
     │  端到端功能测试   │
    └─────────────────┘
   
      集成测试 (20%)
   ┌─────────────────────┐
  │   API接口集成测试    │
 └─────────────────────┘

       单元测试 (70%)
 ┌───────────────────────────┐
│  组件/函数/类单元测试      │
└───────────────────────────┘
```

#### 测试用例设计
```typescript
// 单元测试示例
describe('UserService', () => {
  let userService: UserService;
  let mockApiClient: jest.Mocked<ApiClient>;
  
  beforeEach(() => {
    mockApiClient = createMockApiClient();
    userService = new UserService(mockApiClient);
  });
  
  describe('getUserById', () => {
    it('should return user when API call succeeds', async () => {
      // Arrange
      const userId = 1;
      const expectedUser = { id: 1, name: 'John', email: 'john@example.com' };
      mockApiClient.get.mockResolvedValue({ data: expectedUser });
      
      // Act
      const result = await userService.getUserById(userId);
      
      // Assert
      expect(result).toEqual(expectedUser);
      expect(mockApiClient.get).toHaveBeenCalledWith('/users/1');
    });
    
    it('should return null when API call fails', async () => {
      // Arrange
      const userId = 1;
      mockApiClient.get.mockRejectedValue(new Error('Network error'));
      
      // Act
      const result = await userService.getUserById(userId);
      
      // Assert
      expect(result).toBeNull();
    });
  });
});
```

### 7.3 性能标准

#### 性能指标要求
| 指标 | 目标值 | 测试方法 |
|------|--------|----------|
| 页面加载时间 | < 2秒 | Lighthouse测试 |
| API响应时间 | < 500ms | 压力测试 |
| 并发用户数 | > 1000 | 负载测试 |
| 数据库查询 | < 100ms | 慢查询监控 |
| 内存使用率 | < 80% | 系统监控 |
| CPU使用率 | < 70% | 系统监控 |

#### 性能测试计划
```javascript
// 性能测试脚本示例 (使用k6)
import http from 'k6/http';
import { check, sleep } from 'k6';

export let options = {
  stages: [
    { duration: '2m', target: 100 }, // 2分钟内增加到100用户
    { duration: '5m', target: 100 }, // 保持100用户5分钟
    { duration: '2m', target: 200 }, // 2分钟内增加到200用户
    { duration: '5m', target: 200 }, // 保持200用户5分钟
    { duration: '2m', target: 0 },   // 2分钟内减少到0用户
  ],
};

export default function() {
  // 测试预约接口
  let response = http.post('http://api.museum.com/reservations', {
    name: '测试用户',
    idCard: '123456789012345678',
    visitDate: '2024-01-15',
    timeSlot: '09:00-10:00'
  });
  
  check(response, {
    'status is 200': (r) => r.status === 200,
    'response time < 500ms': (r) => r.timings.duration < 500,
  });
  
  sleep(1);
}
```

## 8. 部署与运维方案

### 8.1 部署架构

```
┌─────────────────────────────────────────────────────────────┐
│                        负载均衡器                            │
│                    (Nginx + Keepalived)                    │
└─────────────────────────────────────────────────────────────┘
                           │
┌─────────────────────────────────────────────────────────────┐
│                      Web服务器集群                          │
├─────────────────┬─────────────────┬─────────────────────────┤
│   Web Server 1  │   Web Server 2  │      Web Server 3       │
│  (Docker容器)   │  (Docker容器)   │     (Docker容器)        │
└─────────────────┴─────────────────┴─────────────────────────┘
                           │
┌─────────────────────────────────────────────────────────────┐
│                      应用服务器集群                          │
├─────────────────┬─────────────────┬─────────────────────────┤
│   App Server 1  │   App Server 2  │      App Server 3       │
│  (Spring Boot)  │  (Spring Boot)  │     (Spring Boot)       │
└─────────────────┴─────────────────┴─────────────────────────┘
                           │
┌─────────────────────────────────────────────────────────────┐
│                      数据库集群                              │
├─────────────────┬─────────────────┬─────────────────────────┤
│   MySQL主库     │   MySQL从库1    │      MySQL从库2         │
│   (读写)        │   (只读)        │       (只读)            │
└─────────────────┴─────────────────┴─────────────────────────┘
                           │
┌─────────────────────────────────────────────────────────────┐
│                      缓存集群                                │
├─────────────────┬─────────────────┬─────────────────────────┤
│   Redis主节点   │   Redis从节点   │      Redis哨兵          │
└─────────────────┴─────────────────┴─────────────────────────┘
```

### 8.2 Docker容器化

#### 前端Dockerfile
```dockerfile
# 多阶段构建
FROM node:18-alpine AS builder

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

# 生产镜像
FROM nginx:alpine

COPY --from=builder /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/nginx.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

#### 后端Dockerfile
```dockerfile
FROM openjdk:17-jre-slim

WORKDIR /app

COPY target/museum-reservation-*.jar app.jar

EXPOSE 8080

ENTRYPOINT ["java", "-jar", "app.jar"]
```

#### Docker Compose配置
```yaml
version: '3.8'

services:
  frontend:
    build: ./frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    networks:
      - museum-network

  backend:
    build: ./backend
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=production
      - DB_HOST=mysql
      - REDIS_HOST=redis
    depends_on:
      - mysql
      - redis
    networks:
      - museum-network

  mysql:
    image: mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=rootpassword
      - MYSQL_DATABASE=museum_reservation
    volumes:
      - mysql-data:/var/lib/mysql
    networks:
      - museum-network

  redis:
    image: redis:7-alpine
    volumes:
      - redis-data:/data
    networks:
      - museum-network

volumes:
  mysql-data:
  redis-data:

networks:
  museum-network:
    driver: bridge
```

### 8.3 监控与日志

#### Prometheus监控配置
```yaml
global:
  scrape_interval: 15s

scrape_configs:
  - job_name: 'museum-backend'
    static_configs:
      - targets: ['backend:8080']
    metrics_path: '/actuator/prometheus'
    
  - job_name: 'mysql'
    static_configs:
      - targets: ['mysql-exporter:9104']
    
  - job_name: 'redis'
    static_configs:
      - targets: ['redis-exporter:9121']
```

#### 日志收集配置
```yaml
# Filebeat配置
filebeat.inputs:
- type: log
  enabled: true
  paths:
    - /var/log/museum/*.log
  fields:
    service: museum-backend
    environment: production

output.elasticsearch:
  hosts: ["elasticsearch:9200"]
  index: "museum-logs-%{+yyyy.MM.dd}"

logging.level: info
```

## 9. 总结与建议

### 9.1 方案总结

重新开发博物馆预约系统是一个**技术先进、架构合理但成本较高**的方案。该方案具有以下特点：

#### 优势
1. **技术领先**：采用最新技术栈，系统性能和用户体验更优
2. **架构合理**：专门为博物馆业务设计，扩展性和维护性更强
3. **安全可靠**：从零开始设计安全架构，数据安全有保障
4. **功能完整**：可以实现所有需求功能，无技术债务
5. **长期价值**：5年总拥有成本与改造方案相当，长期价值更高

#### 劣势
1. **开发周期长**：需要8周完成，比改造方案多5周
2. **初始成本高**：初始投资130万，比改造方案多85万
3. **技术风险大**：新技术栈学习成本高，存在未知风险
4. **资源需求多**：需要更多的开发人员和技术专家

### 9.2 适用场景

重新开发方案适合以下场景：

1. **预算充足**：有足够的资金支持完整的开发周期
2. **时间宽裕**：不急于上线，可以接受8周的开发周期
3. **长期规划**：计划长期使用系统，重视系统的可扩展性
4. **技术追求**：希望采用最新技术，提供最佳用户体验
5. **业务复杂**：有复杂的业务需求，需要定制化开发

### 9.3 决策建议

#### 选择重新开发的条件
- 预算 > 150万
- 上线时间 > 2个月
- 对系统性能和扩展性要求很高
- 有经验丰富的技术团队
- 计划长期使用(5年以上)

#### 选择改造方案的条件
- 预算 < 100万
- 上线时间 < 1个月
- 对现有功能基本满意
- 技术团队经验有限
- 短期内可能更换系统

### 9.4 最终建议

基于成本效益分析和风险评估，我们建议：

1. **优先考虑改造方案**：在预算和时间有限的情况下，改造方案是更务实的选择
2. **分阶段实施**：可以先实施改造方案快速上线，后续再考虑重新开发
3. **技术储备**：无论选择哪种方案，都应该加强技术团队建设
4. **长远规划**：制定3-5年的技术发展规划，为未来升级做准备

**综合建议**：除非有充足的预算和时间，否则建议选择改造方案。重新开发方案虽然技术先进，但投资回报周期较长，风险相对较高。