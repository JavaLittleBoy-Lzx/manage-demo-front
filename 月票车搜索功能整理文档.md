# ğŸš— æœˆç¥¨è½¦æœç´¢åŠŸèƒ½æ•´ç†æ–‡æ¡£

## ğŸ“‹ ç›®å½•
1. [å½“å‰å®ç°çŠ¶å†µ](#å½“å‰å®ç°çŠ¶å†µ)
2. [å‰ç«¯æœç´¢å®ç°](#å‰ç«¯æœç´¢å®ç°)
3. [åç«¯æ¥å£åˆ†æ](#åç«¯æ¥å£åˆ†æ)
4. [å­˜åœ¨çš„é—®é¢˜](#å­˜åœ¨çš„é—®é¢˜)
5. [ä¼˜åŒ–å»ºè®®](#ä¼˜åŒ–å»ºè®®)
6. [å…·ä½“å®ç°æ–¹æ¡ˆ](#å…·ä½“å®ç°æ–¹æ¡ˆ)

---

## ğŸ“Š å½“å‰å®ç°çŠ¶å†µ

### âœ… **å·²æœ‰åŠŸèƒ½**
1. **æœˆç¥¨ç®¡ç†é¡µé¢** (`MonthTicket.vue`)
   - åŸºæœ¬çš„æœˆç¥¨æ•°æ®æŸ¥è¯¢å’Œå±•ç¤º
   - æ”¯æŒæŒ‰è½¦ç‰Œå·ã€è½¦ä¸»å§“åç­‰å­—æ®µæœç´¢
   - åˆ†é¡µæ˜¾ç¤ºåŠŸèƒ½

2. **è¿è§„æ·»åŠ é¡µé¢** (`add-violation.vue`)
   - è½¦ç‰Œå·è¾“å…¥å’Œæœç´¢
   - è½¦ä¸»ä¿¡æ¯æŸ¥è¯¢
   - è½¦ç‰Œå»ºè®®åŠŸèƒ½

3. **åç«¯æ¥å£**
   - æœˆç¥¨æ•°æ®è·å–æ¥å£
   - è½¦ä¸»ä¿¡æ¯æŸ¥è¯¢æ¥å£
   - åŸºç¡€çš„æœç´¢åŠŸèƒ½

### âŒ **ç¼ºå¤±åŠŸèƒ½**
1. **æ™ºèƒ½æœç´¢**
   - ç¼ºå°‘æ¨¡ç³Šæœç´¢
   - æ²¡æœ‰æœç´¢å†å²
   - æœç´¢ç»“æœä¸å¤Ÿæ™ºèƒ½

2. **æ•°æ®æ•´åˆ**
   - æœˆç¥¨æ•°æ®ä¸è½¦ä¸»ä¿¡æ¯åˆ†ç¦»
   - ç¼ºå°‘åœ¨åœºçŠ¶æ€åˆ¤æ–­
   - æ²¡æœ‰æ‹†åˆ†å¤šè½¦ç‰Œè®°å½•

3. **ç”¨æˆ·ä½“éªŒ**
   - æœç´¢å“åº”æ…¢
   - ç»“æœå±•ç¤ºä¸å¤Ÿç›´è§‚
   - ç¼ºå°‘æœç´¢æç¤º

---

## ğŸ” å‰ç«¯æœç´¢å®ç°

### **è¿è§„æ·»åŠ é¡µé¢æœç´¢**
```javascript
// è½¦ç‰Œæœç´¢ç›¸å…³æ–¹æ³•
async generatePlateSuggestions(keyword) {
    if (!keyword || keyword.length < 1) {
        this.showPlateSuggestions = false;
        this.plateSuggestions = [];
        return;
    }

    try {
        console.log('ğŸ” [å»ºè®®æœç´¢] æœç´¢å…³é”®è¯:', keyword);
        
        // è°ƒç”¨è½¦ç‰Œæœç´¢API
        const response = await ownerApi.getPlateSuggestions(keyword, {
            page: 1,
            size: 100
        });
        
        if (response && response.data && Array.isArray(response.data)) {
            // å¤„ç†æœç´¢ç»“æœ
            const suggestions = response.data.slice(0, 8).map(item => ({
                plateNumber: item.plateNumber || item.plate_number || item.plate,
                ownerName: item.ownerName || item.owner_name || item.name,
                ownerId: item.ownerId || item.owner_id || item.id
            }));
            
            this.plateSuggestions = suggestions;
            this.showPlateSuggestions = true;
        }
    } catch (error) {
        console.error('âŒ [å»ºè®®æœç´¢] æœç´¢å¤±è´¥:', error);
        this.plateSuggestions = [];
        this.showPlateSuggestions = false;
    }
}

// è·å–è½¦ä¸»ä¿¡æ¯
async getOwnerInfo(plateNumber) {
    try {
        const response = await ownerApi.getOwnerByPlate(plateNumber);
        
        if (response && response.data) {
            const ownerData = response.data;
            return {
                ownerId: ownerData.ownerId || ownerData.id,
                name: ownerData.name || ownerData.ownerName,
                phone: ownerData.phone || ownerData.phoneNumber,
                address: ownerData.address || ownerData.homeAddress,
                creditScore: ownerData.creditScore || 0
            };
        }
        
        return null;
    } catch (error) {
        console.error('âŒ æŸ¥è¯¢è½¦ä¸»ä¿¡æ¯å¤±è´¥:', error);
        return null;
    }
}
```

### **æœˆç¥¨ç®¡ç†é¡µé¢æœç´¢**
```javascript
// åŸºç¡€æŸ¥è¯¢åŠŸèƒ½
queryInfoOnly(parkName, carNo, ticketName, userName, timeDays, timePeriodList, userPhone, remark1, remark2, remark3, isFrozen, isValid) {
    QueryWrapper<MonthTick> queryWrapper = new QueryWrapper<>();
    
    // æ¨¡ç³Šæœç´¢
    queryWrapper.like(StringUtils.isNotBlank(carNo), "car_no", carNo);
    queryWrapper.like(StringUtils.isNotBlank(parkName), "park_name", parkName);
    queryWrapper.like(StringUtils.isNotBlank(ticketName), "ticket_name", ticketName);
    queryWrapper.like(StringUtils.isNotBlank(userName), "user_name", userName);
    queryWrapper.like(StringUtils.isNotBlank(userPhone), "user_phone", userPhone);
    
    return monthTicketMapper.selectList(queryWrapper);
}
```

---

## ğŸ”§ åç«¯æ¥å£åˆ†æ

### **æœˆç¥¨ç›¸å…³æ¥å£**

#### 1. **è·å–åœ¨çº¿æœˆç¥¨åˆ—è¡¨**
```java
@PostMapping("/getOnlineMonthTicketList")
public ResponseEntity getOnlineMonthTicketList(String parkCodeList, String pageNum, String pageSize, String validStatus) {
    HashMap<String, Object> params = new HashMap<>();
    params.put("parkCodeList", Arrays.asList(parkCodeList));
    params.put("pageNum", pageNum);
    params.put("pageSize", pageSize);
    params.put("validStatus", Integer.parseInt(validStatus));
    
    JSONObject data = aikeConfig.downHandler(AIKEConfig.AK_URL, AIKEConfig.AK_KEY, AIKEConfig.AK_SECRET, "getOnlineMonthTicketList", params);
    return ResponseEntity.ok(data);
}
```

#### 2. **åˆ†é¡µæŸ¥è¯¢æœˆç¥¨**
```java
@GetMapping("/page")
public IPage<MonthTick> findPages(@RequestParam(required = false) String parkName,
                                  @RequestParam(required = false) String carNo,
                                  @RequestParam(required = false) String ticketName,
                                  @RequestParam(required = false) String userName,
                                  // ... å…¶ä»–å‚æ•°
                                  @RequestParam(required = false, defaultValue = "1") Integer pageNum,
                                  @RequestParam(required = false, defaultValue = "10") Integer pageSize) {
    
    List<MonthTick> monthTickPage = monthTicketService.queryInfoOnly(parkName, carNo, ticketName, userName, timeDays, timePeriodList, userPhone, remark1, remark2, remark3, isFrozen, isValid);
    List<MonthTick> asServices = monthTickPage.stream().sorted(Comparator.comparing(MonthTick::getCarNo)).collect(Collectors.toList());
    return PageUtils.getPage(asServices, pageNum, pageSize);
}
```

#### 3. **è½¦ä¸»ä¿¡æ¯æŸ¥è¯¢**
```java
@GetMapping("/getOwnerByPlateNumber")
public Result<Map<String, Object>> getOwnerByPlateNumber(@RequestParam String plateNumber) {
    Map<String, Object> result = violationsService.getOwnerByPlateNumber(plateNumber);
    return Result.success(result);
}
```

### **å½“å‰æ¥å£é—®é¢˜**
1. **æ•°æ®åˆ†ç¦»**ï¼šæœˆç¥¨æ•°æ®å’Œè½¦ä¸»ä¿¡æ¯åˆ†åˆ«æŸ¥è¯¢
2. **æ€§èƒ½é—®é¢˜**ï¼šæ¯æ¬¡éƒ½è°ƒç”¨å¤–éƒ¨APIï¼Œå“åº”æ…¢
3. **æ•°æ®æ ¼å¼**ï¼šè¿”å›æ ¼å¼ä¸ç»Ÿä¸€
4. **æœç´¢é™åˆ¶**ï¼šåªæ”¯æŒç²¾ç¡®åŒ¹é…ï¼Œç¼ºå°‘æ¨¡ç³Šæœç´¢

---

## âš ï¸ å­˜åœ¨çš„é—®é¢˜

### **1. æ•°æ®ç»“æ„é—®é¢˜**
- **å¤šè½¦ç‰Œåˆå¹¶**ï¼šä¸€ä¸ªæœˆç¥¨è®°å½•åŒ…å«å¤šä¸ªè½¦ç‰Œå·ï¼ˆé€—å·åˆ†éš”ï¼‰
- **è½¦ä¸»ä¿¡æ¯åˆ†ç¦»**ï¼šæœˆç¥¨æ•°æ®å’Œè½¦ä¸»è¯¦ç»†ä¿¡æ¯åˆ†å¼€å­˜å‚¨
- **åœ¨åœºçŠ¶æ€ç¼ºå¤±**ï¼šæ— æ³•åˆ¤æ–­è½¦è¾†æ˜¯å¦åœ¨åœº

### **2. æœç´¢æ€§èƒ½é—®é¢˜**
- **APIè°ƒç”¨é¢‘ç¹**ï¼šæ¯æ¬¡æœç´¢éƒ½è°ƒç”¨å¤–éƒ¨æ¥å£
- **æ•°æ®é‡å¤§**ï¼šæœˆç¥¨æ•°æ®é‡å¤§ï¼ŒæŸ¥è¯¢æ…¢
- **ç¼“å­˜ç¼ºå¤±**ï¼šæ²¡æœ‰æœ¬åœ°ç¼“å­˜æœºåˆ¶

### **3. ç”¨æˆ·ä½“éªŒé—®é¢˜**
- **æœç´¢ç»“æœä¸ç›´è§‚**ï¼šç¼ºå°‘å…³é”®ä¿¡æ¯å±•ç¤º
- **å“åº”æ—¶é—´é•¿**ï¼šç”¨æˆ·ç­‰å¾…æ—¶é—´è¿‡é•¿
- **æœç´¢å»ºè®®ä¸å‡†ç¡®**ï¼šåŒ¹é…ç®—æ³•ç®€å•

### **4. åŠŸèƒ½å®Œæ•´æ€§é—®é¢˜**
- **æœç´¢èŒƒå›´æœ‰é™**ï¼šåªèƒ½æœç´¢éƒ¨åˆ†å­—æ®µ
- **å†å²è®°å½•ç¼ºå¤±**ï¼šæ²¡æœ‰æœç´¢å†å²
- **æ™ºèƒ½æ¨èç¼ºå¤±**ï¼šæ²¡æœ‰åŸºäºä½¿ç”¨é¢‘ç‡çš„æ¨è

---

## ğŸ’¡ ä¼˜åŒ–å»ºè®®

### **1. æ•°æ®ç»“æ„ä¼˜åŒ–**

#### **æ‹†åˆ†æœˆç¥¨è®°å½•**
```java
// å°†åŒ…å«å¤šä¸ªè½¦ç‰Œçš„æœˆç¥¨è®°å½•æ‹†åˆ†ä¸ºå•ä¸ªè½¦ç‰Œè®°å½•
public List<MonthTicketVehicleDTO> splitMonthTicketToVehicles(MonthTick monthTicket) {
    List<MonthTicketVehicleDTO> vehicles = new ArrayList<>();
    
    // æŒ‰é€—å·åˆ†å‰²è½¦ç‰Œå·
    String[] plateNumbers = monthTicket.getCarNo().split(",");
    
    for (int i = 0; i < plateNumbers.length; i++) {
        String plateNumber = plateNumbers[i].trim();
        
        MonthTicketVehicleDTO vehicle = new MonthTicketVehicleDTO();
        vehicle.setPlateNumber(plateNumber);
        vehicle.setTicketName(monthTicket.getTicketName());
        vehicle.setOwnerName(monthTicket.getUserName());
        vehicle.setOwnerPhone(monthTicket.getUserPhone());
        vehicle.setParkName(monthTicket.getParkName());
        vehicle.setValidStatus(monthTicket.getValidStatus());
        vehicle.setIsFrozen(monthTicket.getIsFrozen());
        
        // æ™ºèƒ½åˆ†é…è½¦ä½ä¿¡æ¯ï¼ˆå¦‚æœæœ‰å¤šä¸ªè½¦ä½ï¼‰
        if (monthTicket.getRemark1() != null && monthTicket.getRemark1().contains(",")) {
            String[] parkingSpots = monthTicket.getRemark1().split(",");
            if (i < parkingSpots.length) {
                vehicle.setParkingSpot(parkingSpots[i].trim());
            }
        } else {
            vehicle.setParkingSpot(monthTicket.getRemark1());
        }
        
        vehicles.add(vehicle);
    }
    
    return vehicles;
}
```

#### **åˆ›å»ºç»¼åˆæœç´¢DTO**
```java
@Data
public class MonthTicketVehicleDTO {
    private String plateNumber;        // è½¦ç‰Œå·
    private String ticketName;         // æœˆç¥¨åç§°
    private String ownerName;          // è½¦ä¸»å§“å
    private String ownerPhone;         // è½¦ä¸»ç”µè¯
    private String parkName;           // è½¦åœºåç§°
    private String parkingSpot;        // è½¦ä½å·
    private Integer validStatus;       // æœ‰æ•ˆçŠ¶æ€
    private Integer isFrozen;          // æ˜¯å¦å†»ç»“
    private Boolean isInPark;          // æ˜¯å¦åœ¨åœº
    private String lastEntryTime;      // æœ€åå…¥åœºæ—¶é—´
    private Integer appointmentCount;  // é¢„çº¦è®°å½•æ•°
    private Integer violationCount;    // è¿è§„è®°å½•æ•°
    private Integer creditScore;       // ä¿¡ç”¨åˆ†æ•°
}
```

### **2. æœç´¢åŠŸèƒ½ä¼˜åŒ–**

#### **æ™ºèƒ½æœç´¢æ¥å£**
```java
@GetMapping("/searchMonthTicketVehicles")
public ResponseEntity<Result> searchMonthTicketVehicles(
    @RequestParam String keyword,                           // æœç´¢å…³é”®è¯
    @RequestParam String parkName,                          // è½¦åœºåç§°
    @RequestParam(defaultValue = "true") Boolean onlyInPark, // åªè¿”å›åœ¨åœºè½¦è¾†
    @RequestParam(defaultValue = "1") Integer page,
    @RequestParam(defaultValue = "50") Integer size
) {
    try {
        // 1. è·å–è½¦åœºä»£ç 
        String parkCode = getParkCodeByName(parkName);
        
        // 2. æ‰§è¡Œæœç´¢
        SearchResult<MonthTicketVehicleDTO> result = monthTicketService.smartSearch(
            keyword, parkCode, onlyInPark, page, size
        );
        
        return ResponseEntity.ok(Result.success(result));
    } catch (Exception e) {
        return ResponseEntity.ok(Result.error("æœç´¢å¤±è´¥: " + e.getMessage()));
    }
}
```

#### **æ™ºèƒ½æœç´¢å®ç°**
```java
public SearchResult<MonthTicketVehicleDTO> smartSearch(String keyword, String parkCode, Boolean onlyInPark, Integer page, Integer size) {
    // 1. æ„å»ºæœç´¢æ¡ä»¶
    SearchCondition condition = buildSearchCondition(keyword, parkCode, onlyInPark);
    
    // 2. æ‰§è¡Œå¤šå­—æ®µæœç´¢
    List<MonthTick> monthTickets = searchMonthTickets(condition);
    
    // 3. æ‹†åˆ†ä¸ºå•ä¸ªè½¦è¾†è®°å½•
    List<MonthTicketVehicleDTO> vehicles = new ArrayList<>();
    for (MonthTick ticket : monthTickets) {
        vehicles.addAll(splitMonthTicketToVehicles(ticket));
    }
    
    // 4. è¿‡æ»¤åŒ¹é…çš„è®°å½•
    List<MonthTicketVehicleDTO> filteredVehicles = vehicles.stream()
        .filter(vehicle -> matchesKeyword(vehicle, keyword))
        .collect(Collectors.toList());
    
    // 5. æŸ¥è¯¢åœ¨åœºçŠ¶æ€ï¼ˆå¦‚æœéœ€è¦ï¼‰
    if (onlyInPark != null && onlyInPark) {
        filteredVehicles = filterInParkVehicles(filteredVehicles, parkCode);
    }
    
    // 6. æŒ‰ç›¸å…³åº¦æ’åº
    filteredVehicles.sort(this::compareRelevance);
    
    // 7. åˆ†é¡µå¤„ç†
    return PageUtils.getPage(filteredVehicles, page, size);
}

// æ„å»ºæœç´¢æ¡ä»¶
private SearchCondition buildSearchCondition(String keyword, String parkCode, Boolean onlyInPark) {
    SearchCondition condition = new SearchCondition();
    condition.setKeyword(keyword);
    condition.setParkCode(parkCode);
    condition.setOnlyInPark(onlyInPark);
    
    // æ ¹æ®å…³é”®è¯ç±»å‹è®¾ç½®ä¸åŒçš„æœç´¢ç­–ç•¥
    if (isPlateNumber(keyword)) {
        condition.setSearchType(SearchType.PLATE_NUMBER);
    } else if (isPhoneNumber(keyword)) {
        condition.setSearchType(SearchType.PHONE_NUMBER);
    } else {
        condition.setSearchType(SearchType.OWNER_NAME);
    }
    
    return condition;
}

// å¤šå­—æ®µåŒ¹é…
private boolean matchesKeyword(MonthTicketVehicleDTO vehicle, String keyword) {
    String lowerKeyword = keyword.toLowerCase();
    
    return (vehicle.getPlateNumber() != null && vehicle.getPlateNumber().toLowerCase().contains(lowerKeyword)) ||
           (vehicle.getOwnerName() != null && vehicle.getOwnerName().toLowerCase().contains(lowerKeyword)) ||
           (vehicle.getOwnerPhone() != null && vehicle.getOwnerPhone().contains(keyword)) ||
           (vehicle.getParkingSpot() != null && vehicle.getParkingSpot().toLowerCase().contains(lowerKeyword));
}

// æŸ¥è¯¢åœ¨åœºçŠ¶æ€
private List<MonthTicketVehicleDTO> filterInParkVehicles(List<MonthTicketVehicleDTO> vehicles, String parkCode) {
    return vehicles.stream()
        .peek(vehicle -> {
            // è°ƒç”¨åœè½¦åœºAPIæŸ¥è¯¢åœ¨åœºçŠ¶æ€
            Boolean isInPark = checkVehicleInPark(vehicle.getPlateNumber(), parkCode);
            vehicle.setIsInPark(isInPark);
        })
        .filter(vehicle -> Boolean.TRUE.equals(vehicle.getIsInPark()))
        .collect(Collectors.toList());
}
```

### **3. ç¼“å­˜ä¼˜åŒ–**

#### **Redisç¼“å­˜ç­–ç•¥**
```java
@Service
public class MonthTicketCacheService {
    
    @Autowired
    private RedisTemplate<String, Object> redisTemplate;
    
    private static final String CACHE_PREFIX = "month_ticket:";
    private static final long CACHE_EXPIRE = 300; // 5åˆ†é’Ÿ
    
    // ç¼“å­˜æœç´¢ç»“æœ
    public void cacheSearchResult(String keyword, String parkCode, SearchResult result) {
        String key = CACHE_PREFIX + "search:" + parkCode + ":" + keyword.hashCode();
        redisTemplate.opsForValue().set(key, result, CACHE_EXPIRE, TimeUnit.SECONDS);
    }
    
    // è·å–ç¼“å­˜çš„æœç´¢ç»“æœ
    public SearchResult getCachedSearchResult(String keyword, String parkCode) {
        String key = CACHE_PREFIX + "search:" + parkCode + ":" + keyword.hashCode();
        return (SearchResult) redisTemplate.opsForValue().get(key);
    }
    
    // ç¼“å­˜è½¦è¾†åœ¨åœºçŠ¶æ€
    public void cacheVehicleStatus(String plateNumber, String parkCode, Boolean isInPark) {
        String key = CACHE_PREFIX + "status:" + parkCode + ":" + plateNumber;
        redisTemplate.opsForValue().set(key, isInPark, 60, TimeUnit.SECONDS); // 1åˆ†é’Ÿ
    }
    
    // è·å–è½¦è¾†åœ¨åœºçŠ¶æ€
    public Boolean getCachedVehicleStatus(String plateNumber, String parkCode) {
        String key = CACHE_PREFIX + "status:" + parkCode + ":" + plateNumber;
        return (Boolean) redisTemplate.opsForValue().get(key);
    }
}
```

### **4. å‰ç«¯ä¼˜åŒ–**

#### **æœç´¢ç»„ä»¶ä¼˜åŒ–**
```javascript
// æ™ºèƒ½æœç´¢æ–¹æ³•
async smartSearchVehicles(keyword) {
    if (!keyword || keyword.length < 1) {
        this.searchResults = [];
        return;
    }
    
    try {
        this.isSearching = true;
        
        // è°ƒç”¨ä¼˜åŒ–åçš„æœç´¢æ¥å£
        const response = await violationApi.searchMonthTicketVehicles({
            keyword: keyword,
            parkName: this.currentPark,
            onlyInPark: true, // åªè¿”å›åœ¨åœºè½¦è¾†
            page: 1,
            size: 20
        });
        
        if (response && response.data) {
            this.searchResults = response.data.records || [];
            this.totalResults = response.data.total || 0;
            
            // å¼‚æ­¥åŠ è½½é¢å¤–ä¿¡æ¯ï¼ˆé¢„çº¦è®°å½•æ•°ã€è¿è§„è®°å½•æ•°ç­‰ï¼‰
            this.loadAdditionalInfo();
        }
    } catch (error) {
        console.error('æœç´¢å¤±è´¥:', error);
        this.searchResults = [];
    } finally {
        this.isSearching = false;
    }
}

// é˜²æŠ–æœç´¢
debounceSearch: debounce(function(keyword) {
    this.smartSearchVehicles(keyword);
}, 300),

// æœç´¢å†å²ç®¡ç†
addToSearchHistory(keyword) {
    if (!keyword) return;
    
    let history = uni.getStorageSync('search_history') || [];
    
    // ç§»é™¤é‡å¤é¡¹
    history = history.filter(item => item !== keyword);
    
    // æ·»åŠ åˆ°å¼€å¤´
    history.unshift(keyword);
    
    // é™åˆ¶å†å²è®°å½•æ•°é‡
    if (history.length > 10) {
        history = history.slice(0, 10);
    }
    
    uni.setStorageSync('search_history', history);
    this.searchHistory = history;
}
```

#### **æœç´¢ç»“æœå±•ç¤ºä¼˜åŒ–**
```vue
<template>
    <view class="search-results">
        <view class="result-header" v-if="searchResults.length > 0">
            <text class="result-count">æ‰¾åˆ° {{ totalResults }} ä¸ªç»“æœ</text>
            <text class="result-time">{{ searchTime }}ms</text>
        </view>
        
        <view class="result-list">
            <view class="result-item" v-for="(vehicle, index) in searchResults" :key="index"
                @click="selectVehicle(vehicle)">
                
                <!-- è½¦ç‰Œå· -->
                <view class="vehicle-plate" 
                    :class="isNewEnergyPlate(vehicle.plateNumber) ? 'green-plate' : 'blue-plate'">
                    {{ vehicle.plateNumber }}
                </view>
                
                <!-- è½¦ä¸»ä¿¡æ¯ -->
                <view class="vehicle-info">
                    <view class="info-row">
                        <text class="owner-name">{{ vehicle.ownerName }}</text>
                        <text class="owner-phone">{{ formatPhone(vehicle.ownerPhone) }}</text>
                    </view>
                    <view class="info-row">
                        <text class="parking-spot">{{ vehicle.parkingSpot }}</text>
                        <text class="ticket-name">{{ vehicle.ticketName }}</text>
                    </view>
                </view>
                
                <!-- çŠ¶æ€æ ‡è¯† -->
                <view class="vehicle-status">
                    <view class="status-tag in-park" v-if="vehicle.isInPark">åœ¨åœº</view>
                    <view class="status-tag frozen" v-if="vehicle.isFrozen">å†»ç»“</view>
                    <view class="status-tag expired" v-if="vehicle.validStatus === 4">è¿‡æœŸ</view>
                </view>
                
                <!-- ç»Ÿè®¡ä¿¡æ¯ -->
                <view class="vehicle-stats">
                    <text class="stat-item">é¢„çº¦{{ vehicle.appointmentCount || 0 }}æ¬¡</text>
                    <text class="stat-item">è¿è§„{{ vehicle.violationCount || 0 }}æ¬¡</text>
                    <text class="stat-item">ä¿¡ç”¨{{ vehicle.creditScore || 0 }}åˆ†</text>
                </view>
            </view>
        </view>
        
        <!-- åŠ è½½æ›´å¤š -->
        <view class="load-more" v-if="hasMore" @click="loadMore">
            <text class="load-more-text">åŠ è½½æ›´å¤š</text>
        </view>
    </view>
</template>
```

---

## ğŸš€ å…·ä½“å®ç°æ–¹æ¡ˆ

### **é˜¶æ®µä¸€ï¼šåç«¯æ¥å£ä¼˜åŒ–**

#### **1. åˆ›å»ºæ–°çš„æœç´¢æ¥å£**
```java
@RestController
@RequestMapping("/parking/monthTicket")
public class MonthTicketSearchController {
    
    @Autowired
    private MonthTicketSearchService searchService;
    
    @GetMapping("/smartSearch")
    public ResponseEntity<Result> smartSearch(
        @RequestParam String keyword,
        @RequestParam String parkName,
        @RequestParam(defaultValue = "true") Boolean onlyInPark,
        @RequestParam(defaultValue = "1") Integer page,
        @RequestParam(defaultValue = "20") Integer size
    ) {
        SearchResult result = searchService.smartSearch(keyword, parkName, onlyInPark, page, size);
        return ResponseEntity.ok(Result.success(result));
    }
    
    @GetMapping("/getVehicleDetails")
    public ResponseEntity<Result> getVehicleDetails(@RequestParam String plateNumber) {
        VehicleDetailsDTO details = searchService.getVehicleDetails(plateNumber);
        return ResponseEntity.ok(Result.success(details));
    }
}
```

#### **2. å®ç°æœç´¢æœåŠ¡**
```java
@Service
public class MonthTicketSearchServiceImpl implements MonthTicketSearchService {
    
    @Autowired
    private MonthTicketMapper monthTicketMapper;
    
    @Autowired
    private MonthTicketCacheService cacheService;
    
    @Override
    public SearchResult smartSearch(String keyword, String parkName, Boolean onlyInPark, Integer page, Integer size) {
        // 1. æ£€æŸ¥ç¼“å­˜
        SearchResult cachedResult = cacheService.getCachedSearchResult(keyword, parkName);
        if (cachedResult != null) {
            return cachedResult;
        }
        
        // 2. æ‰§è¡Œæœç´¢
        SearchResult result = performSearch(keyword, parkName, onlyInPark, page, size);
        
        // 3. ç¼“å­˜ç»“æœ
        cacheService.cacheSearchResult(keyword, parkName, result);
        
        return result;
    }
    
    private SearchResult performSearch(String keyword, String parkName, Boolean onlyInPark, Integer page, Integer size) {
        // å®ç°å…·ä½“æœç´¢é€»è¾‘
        // ...
    }
}
```

### **é˜¶æ®µäºŒï¼šå‰ç«¯æœç´¢ä¼˜åŒ–**

#### **1. æ›´æ–°APIè°ƒç”¨**
```javascript
// api/violation-api.js
const violationApi = {
    // æ™ºèƒ½æœç´¢æœˆç¥¨è½¦è¾†
    searchMonthTicketVehicles(params) {
        return request({
            url: '/parking/monthTicket/smartSearch',
            method: 'GET',
            params
        });
    },
    
    // è·å–è½¦è¾†è¯¦ç»†ä¿¡æ¯
    getVehicleDetails(plateNumber) {
        return request({
            url: '/parking/monthTicket/getVehicleDetails',
            method: 'GET',
            params: { plateNumber }
        });
    }
};
```

#### **2. æ›´æ–°æœç´¢ç»„ä»¶**
```vue
<!-- æœç´¢ç»„ä»¶ -->
<template>
    <view class="smart-search-container">
        <!-- æœç´¢è¾“å…¥æ¡† -->
        <view class="search-input-container">
            <input 
                class="search-input" 
                v-model="searchKeyword" 
                placeholder="æœç´¢è½¦ç‰Œå·/è½¦ä¸»å§“å/æ‰‹æœºå·"
                @input="onSearchInput"
                @focus="onSearchFocus"
            />
            <view class="search-btn" @click="performSearch">
                <u-icon name="search" size="20"></u-icon>
            </view>
        </view>
        
        <!-- æœç´¢å†å² -->
        <view class="search-history" v-if="showHistory && searchHistory.length > 0">
            <view class="history-header">
                <text class="history-title">æœç´¢å†å²</text>
                <text class="clear-history" @click="clearHistory">æ¸…ç©º</text>
            </view>
            <view class="history-tags">
                <view class="history-tag" v-for="(item, index) in searchHistory" :key="index"
                    @click="selectHistoryItem(item)">
                    {{ item }}
                </view>
            </view>
        </view>
        
        <!-- æœç´¢ç»“æœ -->
        <view class="search-results" v-if="searchResults.length > 0">
            <!-- ç»“æœå±•ç¤º -->
        </view>
    </view>
</template>

<script>
export default {
    data() {
        return {
            searchKeyword: '',
            searchResults: [],
            searchHistory: [],
            showHistory: false,
            isSearching: false
        };
    },
    
    methods: {
        onSearchInput(e) {
            this.searchKeyword = e.detail.value;
            this.debounceSearch(this.searchKeyword);
        },
        
        debounceSearch: debounce(function(keyword) {
            if (keyword) {
                this.performSearch();
            } else {
                this.searchResults = [];
            }
        }, 300),
        
        async performSearch() {
            if (!this.searchKeyword) return;
            
            this.isSearching = true;
            
            try {
                const response = await violationApi.searchMonthTicketVehicles({
                    keyword: this.searchKeyword,
                    parkName: this.currentPark,
                    onlyInPark: true,
                    page: 1,
                    size: 20
                });
                
                if (response && response.data) {
                    this.searchResults = response.data.records || [];
                    this.addToSearchHistory(this.searchKeyword);
                }
            } catch (error) {
                console.error('æœç´¢å¤±è´¥:', error);
                uni.showToast({
                    title: 'æœç´¢å¤±è´¥',
                    icon: 'error'
                });
            } finally {
                this.isSearching = false;
            }
        }
    }
};
</script>
```

### **é˜¶æ®µä¸‰ï¼šæ€§èƒ½å’Œç”¨æˆ·ä½“éªŒä¼˜åŒ–**

#### **1. æ·»åŠ åŠ è½½çŠ¶æ€**
```vue
<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-container" v-if="isSearching">
    <u-loading-icon mode="spinner"></u-loading-icon>
    <text class="loading-text">æ­£åœ¨æœç´¢...</text>
</view>
```

#### **2. æ·»åŠ é”™è¯¯å¤„ç†**
```javascript
// é”™è¯¯å¤„ç†
handleSearchError(error) {
    let message = 'æœç´¢å¤±è´¥';
    
    if (error.response) {
        switch (error.response.status) {
            case 400:
                message = 'æœç´¢å‚æ•°é”™è¯¯';
                break;
            case 500:
                message = 'æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•';
                break;
            case 504:
                message = 'æœç´¢è¶…æ—¶ï¼Œè¯·é‡è¯•';
                break;
        }
    } else if (error.code === 'NETWORK_ERROR') {
        message = 'ç½‘ç»œè¿æ¥å¤±è´¥';
    }
    
    uni.showToast({
        title: message,
        icon: 'error',
        duration: 2000
    });
}
```

#### **3. æ·»åŠ æœç´¢ç»Ÿè®¡**
```javascript
// æœç´¢ç»Ÿè®¡
trackSearch(keyword, resultCount, searchTime) {
    // è®°å½•æœç´¢ç»Ÿè®¡æ•°æ®
    const searchLog = {
        keyword,
        resultCount,
        searchTime,
        timestamp: new Date().getTime(),
        userId: this.currentUserId
    };
    
    // å‘é€ç»Ÿè®¡æ•°æ®åˆ°åç«¯
    this.reportSearchStatistics(searchLog);
}
```

---

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### **æ€§èƒ½æå‡**
- æœç´¢å“åº”æ—¶é—´ä» 2-5ç§’ é™è‡³ 200-500æ¯«ç§’
- æ”¯æŒå¹¶å‘æœç´¢ï¼Œæé«˜ç³»ç»Ÿååé‡
- å‡å°‘å¤–éƒ¨APIè°ƒç”¨ï¼Œé™ä½ç³»ç»Ÿè´Ÿè½½

### **ç”¨æˆ·ä½“éªŒæ”¹å–„**
- æ™ºèƒ½æœç´¢å»ºè®®ï¼Œæé«˜æœç´¢å‡†ç¡®ç‡
- å®æ—¶æœç´¢ç»“æœï¼Œæ— éœ€æ‰‹åŠ¨è§¦å‘
- æœç´¢å†å²è®°å½•ï¼Œæé«˜æ“ä½œæ•ˆç‡

### **åŠŸèƒ½å®Œå–„**
- æ”¯æŒå¤šå­—æ®µæ¨¡ç³Šæœç´¢
- è½¦è¾†åœ¨åœºçŠ¶æ€å®æ—¶æ˜¾ç¤º
- å®Œæ•´çš„è½¦è¾†ä¿¡æ¯å±•ç¤º

### **æ•°æ®å®Œæ•´æ€§**
- æœˆç¥¨æ•°æ®ä¸è½¦ä¸»ä¿¡æ¯æ•´åˆ
- è½¦è¾†çŠ¶æ€ä¿¡æ¯å®æ—¶æ›´æ–°
- å†å²è®°å½•å’Œç»Ÿè®¡æ•°æ®å®Œå–„

---

## ğŸ¯ æ€»ç»“

é€šè¿‡ä»¥ä¸Šä¼˜åŒ–æ–¹æ¡ˆï¼Œæœˆç¥¨è½¦æœç´¢åŠŸèƒ½å°†å¾—åˆ°å…¨é¢æå‡ï¼š

1. **åç«¯ä¼˜åŒ–**ï¼šæ–°å¢æ™ºèƒ½æœç´¢æ¥å£ï¼Œæ”¯æŒå¤šå­—æ®µæœç´¢å’Œæ•°æ®æ•´åˆ
2. **å‰ç«¯ä¼˜åŒ–**ï¼šæ”¹å–„æœç´¢ä½“éªŒï¼Œå¢åŠ å†å²è®°å½•å’Œæ™ºèƒ½å»ºè®®
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šæ·»åŠ ç¼“å­˜æœºåˆ¶ï¼Œæé«˜æœç´¢å“åº”é€Ÿåº¦
4. **ç”¨æˆ·ä½“éªŒ**ï¼šæä¾›æ›´ç›´è§‚çš„æœç´¢ç»“æœå±•ç¤ºå’Œæ“ä½œåé¦ˆ

è¿™äº›ä¼˜åŒ–å°†æ˜¾è‘—æå‡è¿è§„ç®¡ç†ç³»ç»Ÿçš„ä½¿ç”¨æ•ˆç‡å’Œç”¨æˆ·æ»¡æ„åº¦ã€‚ 