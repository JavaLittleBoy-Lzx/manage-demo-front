# 博物馆预约系统改造方案

## 一、项目现状分析

根据工作区的文件结构分析，当前项目是一个基于Vue.js的前端管理系统，主要功能可能与车辆管理、预约审核等相关。项目使用了Element UI组件库，采用了Vue Router进行路由管理，Vuex进行状态管理。

## 二、需求分析

根据《博物馆预约系统功能要求.md》文档，需要开发一个博物馆预约系统，主要包括以下功能模块：

1. **首页展示**：博物馆照片背景、开闭馆时间、地址信息、导航菜单
2. **个人预约**：实名认证、预约信息填写、同行人添加、时段选择、二维码生成
3. **团体预约**：团体类型选择、团体信息填写、成员信息上传、预约确认
4. **个人中心**：预约查询、人员管理、预约取消
5. **后台管理**：数据统计、黑名单管理、预约设置、可视化报表

## 三、改造方案

### 1. 系统架构调整

保留现有Vue.js框架，但需要进行以下架构调整：
wenjian 都是
**目录结构规划**：
- 在views目录下新增museum文件夹，包含博物馆相关的所有页面组件，如首页、个人预约、团体预约、个人中心、预约查询和人员管理页面
- 在admin目录下新增博物馆管理相关页面，包括数据统计、黑名单管理和预约设置页面
- 在components目录下创建museum文件夹，存放可复用的博物馆相关组件，如预约日历组件、访客信息表单组件、二维码显示组件和须知阅读组件
- 在api目录下新增博物馆相关的接口文件
- 在store的modules目录下新增博物馆相关的状态管理文件

### 2. 需要新增的功能模块

#### 2.1 前端页面

1. **博物馆首页**
   - 背景展示区域（轮播图）
   - 开闭馆时间、地址信息展示
   - 导航菜单（个人预约、团体预约、个人中心）
   - 参观须知弹窗

2. **个人预约页面**
   - 实名认证模块
   - 隐私协议阅读与勾选
   - 身份证验证（位数、年龄自动识别）
   - 同行人信息添加（最多5人）
   - 日期与时段选择日历
   - 预约成功二维码展示

3. **团体预约页面**
   - 团体类型选择
   - 团体基本信息填写
   - 成员信息上传（Excel导入和手动添加）
   - 介绍信上传
   - 预约确认流程

4. **个人中心**
   - 预约查询（全部、待参观、已参观、已取消）
   - 人员管理（添加、编辑、删除）
   - 预约取消功能

5. **后台管理页面**
   - 数据统计与可视化
   - 黑名单管理
   - 预约设置（开关、日期、人数）
   - 管理员操作界面

#### 2.2 后端API

需要新增以下API接口：

1. **用户认证相关**
   - 实名认证
   - 用户登录/注册
   - 用户信息获取

2. **预约管理相关**
   - 个人预约创建/查询/取消
   - 团体预约创建/查询/取消
   - 预约时段可用性查询
   - 二维码生成

3. **人员管理相关**
   - 同行人添加/编辑/删除
   - 团体成员批量导入

4. **后台管理相关**
   - 黑名单添加/移除
   - 预约设置修改
   - 数据统计查询

### 3. 具体改造内容

#### 3.1 路由配置修改

需要在路由配置文件中添加新的博物馆相关路由：

**博物馆前台路由规划**：
- 创建博物馆主路由，路径为/museum，包含首页、个人预约、团体预约、个人中心等子路由
- 首页路由：展示博物馆基本信息和导航功能
- 个人预约路由：提供个人预约功能页面
- 团体预约路由：提供团体预约功能页面
- 个人中心路由：提供用户个人信息管理和预约查询功能

**博物馆后台管理路由规划**：
- 创建博物馆管理路由，路径为/museum-admin，仅管理员可访问
- 数据统计路由：展示访客数据统计和可视化图表
- 黑名单管理路由：管理失信人员名单
- 预约设置路由：配置预约相关参数和规则

#### 3.2 核心组件开发

##### 3.2.1 预约日历组件（ReserveCalendar.vue）

需要开发一个预约日历组件，用于显示可预约的日期和时段，主要功能包括：

- 日历显示（月视图）
- 可预约日期高亮显示
- 时段选择（9:00-10:00, 10:00-11:00等）
- 剩余名额显示
- 日期和时段选择事件

##### 3.2.2 访客信息表单组件（VisitorForm.vue）

需要开发一个访客信息表单组件，用于填写预约人和同行人信息，主要功能包括：

- 预约人基本信息填写
- 证件类型选择（身份证、护照等）
- 身份证验证（位数、年龄自动识别）
- 同行人信息添加（最多5人）
- 隐私协议阅读与勾选

##### 3.2.3 二维码显示组件（QRCodeDisplay.vue）

需要开发一个二维码显示组件，用于预约成功后显示动态二维码，主要功能包括：

- 动态二维码生成（60秒有效）
- 预约信息显示
- 倒计时显示

##### 3.2.4 须知阅读组件（NoticeReader.vue）

需要开发一个须知阅读组件，用于显示参观须知和隐私协议，主要功能包括：

- 须知内容展示
- 协议内容展示
- 同意按钮

#### 3.3 数据模型设计

##### 3.3.1 用户模型

**用户基本信息结构**：
- 用户唯一标识ID
- 用户姓名、证件类型、证件号码、手机号码等基本信息
- 黑名单状态标识和黑名单截止日期
- 常用同行人员列表，包含同行人的姓名、证件类型和证件号码

##### 3.3.2 预约模型

**预约信息结构**：
- 预约唯一标识ID和关联的用户ID
- 预约类型（个人预约或团体预约）
- 预约日期、时间段、状态（待参观/已参观/已取消）和创建时间
- 访客信息列表，包含所有参观人员的基本信息
- 团体预约特有信息：团体名称、团体类型、联系人、联系电话、团体介绍等

##### 3.3.3 时段模型

**时间段配置结构**：
- 时段唯一标识ID
- 对应的日期和具体时间段（如9:00-10:00）
- 该时段的最大容量和已预约人数
- 时段状态（开放/关闭）

#### 3.4 API接口设计

##### 3.4.1 用户相关接口

**用户认证接口**：
- 用户登录接口：接收手机号和密码，返回认证令牌和用户信息
- 用户注册接口：接收用户基本信息进行注册，返回注册结果
- 获取用户信息接口：根据令牌获取当前用户详细信息

**同行人管理接口**：
- 添加同行人接口：添加常用同行人信息
- 获取同行人列表接口：获取用户的所有同行人信息
- 删除同行人接口：删除指定的同行人信息

##### 3.4.2 预约相关接口

**预约查询接口**：
- 获取可预约日期接口：返回当前可以预约的日期列表
- 获取时段信息接口：根据指定日期获取该日的时段和剩余名额
- 获取预约列表接口：根据状态筛选获取用户的预约记录

**预约操作接口**：
- 创建个人预约接口：提交个人预约信息，返回预约ID和二维码
- 创建团体预约接口：提交团体预约信息，返回预约ID和状态
- 取消预约接口：取消指定的预约记录
- 获取预约二维码接口：获取预约的动态二维码和有效期

##### 3.4.3 管理后台接口

**数据统计接口**：
- 获取预约统计数据接口：返回日、周、月的访客统计数据
- 获取访客分析数据接口：返回访客类型、年龄段等分析数据

**黑名单管理接口**：
- 获取黑名单列表接口：获取所有失信人员信息
- 添加黑名单接口：将用户加入黑名单并设置解除时间
- 移除黑名单接口：将用户从黑名单中移除

**系统设置接口**：
- 获取预约设置接口：获取当前的预约规则和参数配置
- 更新预约设置接口：修改预约相关的配置参数

### 4. 特殊功能实现方案

#### 4.1 身份证验证与年龄识别

**身份证格式验证**：
- 支持15位和18位身份证号码格式验证
- 使用正则表达式检查身份证号码的基本格式
- 验证最后一位校验码（X或数字）的正确性

**年龄自动识别**：
- 从身份证号码中提取出生年月日信息
- 根据当前日期计算准确年龄
- 处理15位身份证（19xx年出生）和18位身份证的不同格式

**年龄限制验证**：
- 检查是否满足14周岁以上的预约条件
- 对于不满足条件的用户给出明确的提示信息
- 自动识别60周岁以上老人，提供相应的预约优惠政策

#### 4.2 动态二维码生成

**二维码安全机制**：
- 为每个预约生成60秒有效期的临时令牌
- 二维码内容包含预约ID、临时令牌和时间戳
- 使用加密算法确保二维码内容的安全性

**二维码生成流程**：
- 根据预约信息生成唯一的临时访问令牌
- 将预约ID、令牌和时间戳组合成二维码内容
- 使用二维码生成库创建图片格式的二维码
- 返回二维码图片和过期时间供前端显示

#### 4.3 黑名单自动管理

**失信行为监控**：
- 系统自动监控用户的预约履行情况
- 统计最近90天内未到馆且未取消的预约次数
- 当失信次数达到2次时自动加入黑名单

**黑名单管理规则**：
- 失信用户自动加入黑名单，限制60天内无法预约
- 黑名单到期后自动解除限制
- 管理员可手动添加或移除黑名单用户
- 提供黑名单用户的详细失信记录查询

#### 4.4 预约号源管理

**过期预约处理**：
- 系统定时检查已过期但未标记为未到馆的预约记录
- 自动将过期预约状态更新为未到馆状态
- 触发黑名单检查机制，评估用户是否需要加入黑名单

**当日预约灵活处理**：
- 对于当天的预约，如果用户错过了指定时段
- 系统自动将预约转为全天有效，提高用户体验
- 避免因时段限制导致的不必要的失信记录

**号源动态调整**：
- 根据实际到馆情况动态调整各时段的容量
- 释放未使用的预约名额供其他用户预约
- 优化资源配置，提高博物馆的接待效率

### 5. 数据可视化实现

#### 5.1 访客统计图表

使用ECharts库实现以下图表：

1. **每日访客量柱状图**
   - 按日期显示访客量
   - 区分个人和团体访客

2. **访客类型饼图**
   - 老人、成年人、未成年人比例
   - 个人访客与团体访客比例

3. **预约趋势折线图**
   - 按周/月显示预约趋势
   - 同比/环比增长率

#### 5.2 数据看板示例

```vue
<template>
  <div class="stats-dashboard">
    <el-row :gutter="20">
      <el-col :span="6">
        <el-card class="stat-card">
          <div class="stat-title">今日访客</div>
          <div class="stat-value">{{ todayVisitors }}</div>
          <div class="stat-trend" :class="{ 'up': todayTrend > 0, 'down': todayTrend < 0 }">
            {{ todayTrend > 0 ? '+' : '' }}{{ todayTrend }}%
          </div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card class="stat-card">
          <div class="stat-title">本周访客</div>
          <div class="stat-value">{{ weeklyVisitors }}</div>
          <div class="stat-trend" :class="{ 'up': weeklyTrend > 0, 'down': weeklyTrend < 0 }">
            {{ weeklyTrend > 0 ? '+' : '' }}{{ weeklyTrend }}%
          </div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card class="stat-card">
          <div class="stat-title">本月访客</div>
          <div class="stat-value">{{ monthlyVisitors }}</div>
          <div class="stat-trend" :class="{ 'up': monthlyTrend > 0, 'down': monthlyTrend < 0 }">
            {{ monthlyTrend > 0 ? '+' : '' }}{{ monthlyTrend }}%
          </div>
        </el-card>
      </el-col>
      <el-col :span="6">
        <el-card class="stat-card">
          <div class="stat-title">未到访率</div>
          <div class="stat-value">{{ noShowRate }}%</div>
        </el-card>
      </el-col>
    </el-row>
    
    <el-row :gutter="20" class="chart-row">
      <el-col :span="12">
        <el-card class="chart-card">
          <div class="chart-title">每日访客量</div>
          <div class="chart-container" ref="dailyChart"></div>
        </el-card>
      </el-col>
      <el-col :span="12">
        <el-card class="chart-card">
          <div class="chart-title">访客类型分布</div>
          <div class="chart-container" ref="visitorTypeChart"></div>
        </el-card>
      </el-col>
    </el-row>
    
    <el-row :gutter="20" class="chart-row">
      <el-col :span="24">
        <el-card class="chart-card">
          <div class="chart-title">预约趋势</div>
          <div class="chart-container" ref="trendChart"></div>
        </el-card>
      </el-col>
    </el-row>
  </div>
</template>
```

### 6. 实施计划

#### 6.1 阶段一：基础架构搭建（2周）

1. 项目架构调整
2. 路由配置
3. API接口设计
4. 数据模型设计

#### 6.2 阶段二：核心功能开发（4周）

1. 首页开发
2. 个人预约功能
3. 团体预约功能
4. 个人中心功能

#### 6.3 阶段三：后台管理开发（3周）

1. 数据统计功能
2. 黑名单管理
3. 预约设置管理
4. 数据可视化

#### 6.4 阶段四：测试与优化（2周）

1. 功能测试
2. 性能优化
3. 用户体验优化
4. 安全性测试

#### 6.5 阶段五：部署上线（1周）

1. 环境配置
2. 数据迁移
3. 上线部署
4. 运维监控

## 四、技术选型

1. **前端框架**：Vue.js + Element UI
2. **状态管理**：Vuex
3. **路由管理**：Vue Router
4. **HTTP请求**：Axios
5. **数据可视化**：ECharts
6. **二维码生成**：qrcode.js
7. **Excel处理**：xlsx.js
8. **日期处理**：Day.js

## 五、注意事项

1. **安全性考虑**
   - 身份证等敏感信息加密存储
   - 防止SQL注入和XSS攻击
   - 接口权限控制

2. **性能优化**
   - 组件懒加载
   - 图片压缩与CDN加速
   - 数据缓存策略

3. **用户体验**
   - 移动端适配
   - 错误提示友好化
   - 操作流程简化

4. **特殊规则处理**
   - 60周岁以上老人无需预约的识别
   - 14周岁以下不可单独预约的验证
   - 黑名单自动管理
   - 预约号源动态调整

## 六、总结

本改造方案基于现有项目架构，通过新增博物馆预约系统相关功能模块，实现了个人预约、团体预约、预约管理等核心功能。方案充分考虑了需求文档中的各项特殊要求，如身份证验证、年龄识别、黑名单管理、动态二维码等，并提供了详细的技术实现方案。

通过分阶段实施，可以确保项目按计划稳步推进，最终交付一个功能完善、用户体验良好的博物馆预约系统。