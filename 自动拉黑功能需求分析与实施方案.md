# è‡ªåŠ¨æ‹‰é»‘åŠŸèƒ½éœ€æ±‚åˆ†æä¸å®æ–½æ–¹æ¡ˆ

## ğŸ“‹ éœ€æ±‚æ¦‚è¿°

å®ç°ä¸€ä¸ªè‡ªåŠ¨æ‹‰é»‘åŠŸèƒ½ï¼š
- åœ¨ `IllegalRegiste.vue` é¡µé¢ä¸­å±•ç¤ºè½¦è¾†è¿è§„æ¬¡æ•°ï¼ˆè¾¾åˆ°xxæ¬¡æ•°çš„æ ‡è¯†ï¼‰
- åœ¨åç«¯ `createViolation` æ–¹æ³•ä¸­ï¼Œåˆ›å»ºè¿è§„è®°å½•åè‡ªåŠ¨æ£€æŸ¥æ˜¯å¦è¾¾åˆ°é˜ˆå€¼
- è¾¾åˆ°é˜ˆå€¼æ—¶è‡ªåŠ¨è§¦å‘æ‹‰é»‘ï¼Œå¯¹æ­¤è½¦ç‰Œå¯¹åº”çš„æ‰€æœ‰æœªå¤„ç†è¿è§„è®°å½•è¿›è¡Œæ‰¹é‡å¤„ç†
- æ‹‰é»‘æ–¹å¼ä¸º"ç³»ç»Ÿè‡ªåŠ¨æ‹‰é»‘"ï¼ˆprocessType: 'auto_blacklist'ï¼‰

## âœ… å®æ–½çŠ¶æ€

**å®æ–½æ–¹æ¡ˆï¼šæ–¹æ¡ˆBï¼ˆåç«¯å®ç°ï¼‰+ å‰ç«¯æ˜¾ç¤ºä¼˜åŒ–**

### å·²å®Œæˆçš„ä¿®æ”¹ï¼š

#### 1. åç«¯ä¿®æ”¹ âœ…
- âœ… `ViolationsServiceImpl.createViolation()` - æ·»åŠ è‡ªåŠ¨æ‹‰é»‘æ£€æŸ¥é€»è¾‘
- âœ… åªå¯¹"ä¸œåŒ—æ—ä¸šå¤§å­¦"åœè½¦åœºå¯ç”¨è‡ªåŠ¨æ‹‰é»‘åŠŸèƒ½
- âœ… ç»Ÿè®¡è¯¥è½¦ç‰Œåœ¨è¯¥åœè½¦åœºçš„æœªå¤„ç†è¿è§„æ¬¡æ•°
- âœ… è¾¾åˆ°é˜ˆå€¼åè‡ªåŠ¨è°ƒç”¨ACMSæ¥å£æ‹‰é»‘
- âœ… æ‰¹é‡æ ‡è®°è¯¥è½¦ç‰Œçš„æ‰€æœ‰æœªå¤„ç†è¿è§„è®°å½•ä¸ºå·²å¤„ç†
- âœ… ä¿å­˜åˆ°æœ¬åœ°é»‘åå•è¡¨
- âœ… åŒºåˆ†æ‰‹åŠ¨æ‹‰é»‘ï¼ˆmanual_blacklistï¼‰å’Œè‡ªåŠ¨æ‹‰é»‘ï¼ˆauto_blacklistï¼‰

#### 2. å‰ç«¯ä¿®æ”¹ âœ…  
- âœ… `IllegalRegiste.vue` - æ‰¹é‡æŸ¥è¯¢è¿è§„æ¬¡æ•°
- âœ… `IllegalRegiste.vue` - æ˜¾ç¤ºè¿è§„æ¬¡æ•°å¾½ç« 
- âœ… `IllegalRegiste.vue` - æ˜¾ç¤ºè‡ªåŠ¨æ‹‰é»‘è­¦å‘Šæç¤º
- âœ… æ·»åŠ æ ·å¼ç¾åŒ–

---

## ğŸ”‘ å…³é”®å®ç°ä»£ç 

### åç«¯å®ç°ï¼ˆViolationsServiceImpl.javaï¼‰

åœ¨ `createViolation()` æ–¹æ³•ä¸­ï¼Œä¿å­˜è¿è§„è®°å½•åæ·»åŠ è‡ªåŠ¨æ‹‰é»‘æ£€æŸ¥ï¼š

```java
// ğŸ†• è‡ªåŠ¨æ‹‰é»‘æ£€æŸ¥ï¼šç»Ÿè®¡è¿è§„æ¬¡æ•°ï¼Œè¾¾åˆ°é˜ˆå€¼è‡ªåŠ¨æ‹‰é»‘
try {
    // åªå¯¹ä¸œåŒ—æ—ä¸šå¤§å­¦çš„è¿è§„è®°å½•è¿›è¡Œè‡ªåŠ¨æ‹‰é»‘æ£€æŸ¥
    if ("ä¸œåŒ—æ—ä¸šå¤§å­¦".equals(violation.getParkName())) {
        log.info("ğŸ” [è‡ªåŠ¨æ‹‰é»‘æ£€æŸ¥] å¼€å§‹æ£€æŸ¥è½¦ç‰Œ: {}, parkName: {}", 
                violation.getPlateNumber(), violation.getParkName());
        
        // 1. è·å–parkCode
        String parkCode = violation.getParkCode();
        if (parkCode == null || parkCode.trim().isEmpty()) {
            List<String> parkCodes = yardInfoMapper.yardCode(violation.getParkName());
            parkCode = (parkCodes != null && !parkCodes.isEmpty()) ? parkCodes.get(0) : "2KPL6XFF";
        }
        
        // 2. ä¸œåŒ—æ—ä¸šå¤§å­¦é˜ˆå€¼é…ç½®
        // æ–¹æ¡ˆ1ï¼šå›ºå®šé˜ˆå€¼ï¼ˆå½“å‰ä½¿ç”¨ï¼‰
        Integer maxViolationCount = 5;
        
        // æ–¹æ¡ˆ2ï¼šä»é…ç½®è¡¨è¯»å–ï¼ˆå¯é€‰ï¼Œå¦‚éœ€å‰ç«¯é…ç½®ç”Ÿæ•ˆå¯å–æ¶ˆæ³¨é‡Šï¼‰
        // MonthlyTicketTimeoutConfig config = monthlyTicketTimeoutConfigService.getByParkCode("2KPL6XFF");
        // if (config != null && config.getMaxViolationCount() != null) {
        //     maxViolationCount = config.getMaxViolationCount();
        // }
        
        // 3. ç»Ÿè®¡è¯¥è½¦ç‰Œåœ¨è¯¥åœè½¦åœºçš„æœªå¤„ç†è¿è§„æ¬¡æ•°ï¼ˆåŒ…æ‹¬åˆšåˆ›å»ºçš„è¿™æ¡ï¼‰
        LambdaQueryWrapper<Violations> countWrapper = new LambdaQueryWrapper<>();
        countWrapper.eq(Violations::getPlateNumber, violation.getPlateNumber())
                   .eq(Violations::getParkName, violation.getParkName())
                   .eq(Violations::getProcessStatus, "pending");
        
        int unprocessedCount = this.count(countWrapper);
        
        log.info("ğŸ“Š [è¿è§„ç»Ÿè®¡] è½¦ç‰Œ: {}, åœè½¦åœº: {}, æœªå¤„ç†è¿è§„æ¬¡æ•°: {}, é˜ˆå€¼: {}", 
                violation.getPlateNumber(), violation.getParkName(), unprocessedCount, maxViolationCount);
        
        // 4. åˆ¤æ–­æ˜¯å¦è¾¾åˆ°æ‹‰é»‘é˜ˆå€¼
        if (unprocessedCount >= maxViolationCount) {
            log.info("ğŸš« [è§¦å‘è‡ªåŠ¨æ‹‰é»‘] è½¦ç‰Œ {} è¿è§„æ¬¡æ•° {} å·²è¾¾åˆ°é˜ˆå€¼ {}", 
                    violation.getPlateNumber(), unprocessedCount, maxViolationCount);
            
            // 5. è°ƒç”¨ACMSæ¥å£æ·»åŠ é»‘åå•
            AcmsVipService.AddBlacklistRequest acmsRequest = new AcmsVipService.AddBlacklistRequest();
            acmsRequest.setParkName(violation.getParkName());
            acmsRequest.setVipTypeCode("VIOLATION_AUTO");
            acmsRequest.setVipTypeName("è¿è§„è‡ªåŠ¨æ‹‰é»‘");
            acmsRequest.setCarCode(violation.getPlateNumber());
            acmsRequest.setCarOwner(violation.getOwnerName() != null ? violation.getOwnerName() : "æœªçŸ¥è½¦ä¸»");
            acmsRequest.setReason(String.format("ç´¯è®¡è¿è§„%dæ¬¡ï¼Œç³»ç»Ÿè‡ªåŠ¨æ‹‰é»‘", unprocessedCount));
            acmsRequest.setDurationType("permanent");
            acmsRequest.setRemark1(String.format("è‡ªåŠ¨æ‹‰é»‘ï¼Œè¿è§„æ¬¡æ•°: %d", unprocessedCount));
            acmsRequest.setRemark2("ç³»ç»Ÿè‡ªåŠ¨è§¦å‘");
            acmsRequest.setOperator("SYSTEM");
            
            boolean acmsSuccess = acmsVipService.addBlacklistToAcms(acmsRequest);
            
            if (acmsSuccess) {
                log.info("âœ… [ACMSè‡ªåŠ¨æ‹‰é»‘æˆåŠŸ] è½¦ç‰Œ: {}", violation.getPlateNumber());
                
                // 6. æ‰¹é‡æ ‡è®°è¯¥è½¦ç‰Œåœ¨è¯¥åœè½¦åœºçš„æ‰€æœ‰æœªå¤„ç†è¿è§„è®°å½•ä¸ºå·²å¤„ç†
                LambdaQueryWrapper<Violations> updateWrapper = new LambdaQueryWrapper<>();
                updateWrapper.eq(Violations::getPlateNumber, violation.getPlateNumber())
                           .eq(Violations::getParkName, violation.getParkName())
                           .eq(Violations::getProcessStatus, "pending");
                
                Violations updateViolation = new Violations();
                updateViolation.setProcessStatus("processed");
                updateViolation.setProcessType("auto_blacklist"); // è‡ªåŠ¨æ‹‰é»‘ç±»å‹
                updateViolation.setProcessedAt(LocalDateTime.now());
                updateViolation.setProcessedBy("SYSTEM");
                updateViolation.setProcessRemark(String.format("ç´¯è®¡è¿è§„%dæ¬¡ï¼Œç³»ç»Ÿè‡ªåŠ¨æ‹‰é»‘", unprocessedCount));
                
                int updateCount = this.baseMapper.update(updateViolation, updateWrapper);
                log.info("ğŸ“ [æ‰¹é‡æ ‡è®°] è½¦ç‰Œ {} çš„ {} æ¡è¿è§„è®°å½•å·²æ ‡è®°ä¸ºå·²å¤„ç†", 
                        violation.getPlateNumber(), updateCount);
                
                // 7. ä¿å­˜åˆ°æœ¬åœ°é»‘åå•è¡¨
                LambdaQueryWrapper<BlackList> blacklistQuery = new LambdaQueryWrapper<>();
                blacklistQuery.eq(BlackList::getCarCode, violation.getPlateNumber())
                             .eq(BlackList::getParkName, violation.getParkName());
                
                BlackList existingBlackList = blackListMapper.selectOne(blacklistQuery);
                
                if (existingBlackList != null) {
                    // æ›´æ–°å·²æœ‰è®°å½•
                    existingBlackList.setReason(String.format("ç´¯è®¡è¿è§„%dæ¬¡ï¼Œç³»ç»Ÿè‡ªåŠ¨æ‹‰é»‘", unprocessedCount));
                    existingBlackList.setSpecialCarTypeConfigName("è¿è§„è‡ªåŠ¨æ‹‰é»‘");
                    existingBlackList.setBlacklistTypeCode("VIOLATION_AUTO");
                    existingBlackList.setBlackListForeverFlag("æ°¸ä¹…");
                    blackListMapper.updateById(existingBlackList);
                } else {
                    // æ–°å¢è®°å½•
                    BlackList blackList = new BlackList();
                    blackList.setParkName(violation.getParkName());
                    blackList.setCarCode(violation.getPlateNumber());
                    blackList.setOwner(violation.getOwnerName() != null ? violation.getOwnerName() : "æœªçŸ¥è½¦ä¸»");
                    blackList.setReason(String.format("ç´¯è®¡è¿è§„%dæ¬¡ï¼Œç³»ç»Ÿè‡ªåŠ¨æ‹‰é»‘", unprocessedCount));
                    blackList.setSpecialCarTypeConfigName("è¿è§„è‡ªåŠ¨æ‹‰é»‘");
                    blackList.setBlacklistTypeCode("VIOLATION_AUTO");
                    blackList.setBlackListForeverFlag("æ°¸ä¹…");
                    blackListMapper.insert(blackList);
                }
            }
        }
    }
} catch (Exception e) {
    log.error("âŒ [è‡ªåŠ¨æ‹‰é»‘æ£€æŸ¥å¼‚å¸¸] plateNumber={}, error={}", 
        violation.getPlateNumber(), e.getMessage(), e);
    // è‡ªåŠ¨æ‹‰é»‘æ£€æŸ¥å¤±è´¥ä¸å½±å“è¿è§„è®°å½•åˆ›å»º
}
```

**å…³é”®ç‰¹ç‚¹ï¼š**
1. âœ… åªå¯¹"ä¸œåŒ—æ—ä¸šå¤§å­¦"åœè½¦åœºå¯ç”¨è‡ªåŠ¨æ‹‰é»‘
2. âœ… ç›´æ¥åœ¨ `createViolation()` ä¸­å®ç°ï¼Œä¸è°ƒç”¨å¤–éƒ¨service
3. âœ… å‚ç…§æ‰‹åŠ¨æ‹‰é»‘çš„æµç¨‹ï¼šACMSæ¥å£ â†’ æ‰¹é‡æ ‡è®° â†’ æœ¬åœ°é»‘åå•è¡¨
4. âœ… å¼‚å¸¸ä¸å½±å“è¿è§„è®°å½•åˆ›å»º
5. âœ… **å›ºå®šé˜ˆå€¼5æ¬¡**ï¼ˆä¸ä¾èµ–é…ç½®è¡¨ï¼Œç®€å•ç›´æ¥ï¼‰
6. âœ… å¯é€‰æ–¹æ¡ˆï¼šä»é…ç½®è¡¨è¯»å–é˜ˆå€¼ï¼ˆä»£ç ä¸­å·²æ³¨é‡Šï¼Œéœ€è¦æ—¶å–æ¶ˆæ³¨é‡Šï¼‰

### å‰ç«¯å®ç°ï¼ˆIllegalRegiste.vueï¼‰

**1. æ‰¹é‡æŸ¥è¯¢è¿è§„æ¬¡æ•°ï¼š**

```javascript
/**
 * ğŸ†• æ‰¹é‡è·å–è¿è§„æ¬¡æ•°
 * ä¸ºæ¯ä¸ªè½¦ç‰ŒæŸ¥è¯¢æœªå¤„ç†çš„è¿è§„è®°å½•æ•°é‡ï¼Œç”¨äºæ˜¾ç¤ºå¾½ç« 
 */
const batchGetViolationCounts = async (records) => {
    if (!records || records.length === 0) return;
    
    // æå–æ‰€æœ‰ä¸é‡å¤çš„è½¦ç‰Œå·
    const plateNumbers = [...new Set(records.map(r => r.plateNumber).filter(Boolean))];
    
    // å¹¶è¡ŒæŸ¥è¯¢æ¯ä¸ªè½¦ç‰Œçš„è¿è§„æ¬¡æ•°
    const countPromises = plateNumbers.map(async (plateNumber) => {
        try {
            const response = await violationApi.getViolations({
                plateNumber: plateNumber,
                processStatus: 'pending', // åªç»Ÿè®¡æœªå¤„ç†çš„
                page: 1,
                size: 1 // åªéœ€è¦total
            });
            const count = response.data?.data?.total || 0;
            return { plateNumber, count };
        } catch (error) {
            return { plateNumber, count: 0 };
        }
    });
    
    const results = await Promise.all(countPromises);
    
    // å°†è¿è§„æ¬¡æ•°é™„åŠ åˆ°æ¯æ¡è®°å½•
    const countMap = {};
    results.forEach(({ plateNumber, count }) => {
        countMap[plateNumber] = count;
    });
    
    records.forEach(record => {
        record.violationCount = countMap[record.plateNumber] || 0;
    });
};
```

**2. åœ¨getData()ä¸­è°ƒç”¨ï¼š**

```javascript
const getData = () => {
    // ... è·å–æ•°æ®
    violationApi.getViolations(params).then((res) => {
        if (res.data.data && res.data.data.records) {
            originalData.value = res.data.data.records;
            
            // ğŸ†• æ‰¹é‡è·å–è¿è§„æ¬¡æ•°
            batchGetViolationCounts(originalData.value).then(() => {
                applyFrontendFilter();
            });
        }
    });
};
```

**3. è¡¨æ ¼æ¨¡æ¿æ˜¾ç¤ºå¾½ç« ï¼š**

```vue
<el-table-column label="è½¦è¾†ä¿¡æ¯" width="220" fixed="left">
    <template #default="{ row }">
        <div class="vehicle-info-cell">
            <div class="car-number-container">
                <span :class="['plate-number', getPlateType(row.plateNumber)]">
                    {{ row.plateNumber }}
                </span>
                <!-- ğŸ†• è¿è§„æ¬¡æ•°å¾½ç«  -->
                <el-badge 
                    v-if="row.violationCount && row.violationCount >= (configForm.maxViolationCount - 2)"
                    :value="row.violationCount" 
                    :type="row.violationCount >= configForm.maxViolationCount ? 'danger' : 'warning'"
                    :max="99"
                    class="violation-count-badge">
                </el-badge>
            </div>
            <div class="owner-info">
                <div class="owner-name">{{ row.ownerName || 'æœªçŸ¥' }}</div>
                <!-- ğŸ†• è‡ªåŠ¨æ‹‰é»‘è­¦å‘Šæç¤º -->
                <div v-if="row.violationCount >= (configForm.maxViolationCount - 1)" 
                     class="auto-blacklist-warning">
                    <el-icon color="#E6A23C"><WarningFilled /></el-icon>
                    <span>å†è¿è§„{{ Math.max(configForm.maxViolationCount - row.violationCount, 0) }}æ¬¡å°†è‡ªåŠ¨æ‹‰é»‘</span>
                </div>
            </div>
        </div>
    </template>
</el-table-column>
```

---

## ğŸ” ç°æœ‰åŠŸèƒ½åˆ†æ

### 1. IllegalRegiste.vueï¼ˆè¿è§„è®°å½•æŸ¥è¯¢é¡µé¢ï¼‰

#### å·²æœ‰åŠŸèƒ½ï¼š
âœ… **æœˆç¥¨è½¦è¶…æ—¶é…ç½®**ï¼ˆhandleMonthlyTicketConfigï¼‰
- `timeoutMinutes`ï¼šè¶…æ—¶æ—¶é—´
- `maxViolationCount`ï¼šç´¯è®¡æ¬¡æ•°é˜ˆå€¼ â­ï¼ˆè‡ªåŠ¨æ‹‰é»‘çš„å…³é”®é…ç½®ï¼‰
- `overnightTimeHours`ï¼šè¿‡å¤œæ—¶é—´
- `exemptTicketTypes`ï¼šå…æ£€ç±»å‹

âœ… **æ‰‹åŠ¨å¤„ç†åŠŸèƒ½**
- `handleProcess`ï¼šå•æ¡å¤„ç†
- `confirmProcess`ï¼šç¡®è®¤å•æ¡å¤„ç†
- å¤„ç†æ—¶éœ€è¦é€‰æ‹©é»‘åå•ç±»å‹ã€æ‹‰é»‘åŸå› ç­‰

âœ… **æ‰¹é‡å¤„ç†åŠŸèƒ½**
- `handleBatchProcess`ï¼šæ‰¹é‡å¤„ç†
- `confirmBatchProcess`ï¼šç¡®è®¤æ‰¹é‡å¤„ç†

âœ… **å¤„ç†çŠ¶æ€æ˜¾ç¤º**
- `processStatus`ï¼š'pending'ï¼ˆæœªå¤„ç†ï¼‰/ 'processed'ï¼ˆå·²å¤„ç†ï¼‰
- `processType`ï¼š'auto_blacklist'ï¼ˆç³»ç»Ÿè‡ªåŠ¨æ‹‰é»‘ï¼‰/ 'manual'ï¼ˆæ‰‹åŠ¨å¤„ç†ï¼‰
- å¤„ç†ä¿¡æ¯ï¼šå¤„ç†äººã€å¤„ç†æ—¶é—´ã€å¤„ç†å¤‡æ³¨

âœ… **é»‘åå•ç±»å‹åŠ è½½**ï¼ˆloadBlacklistTypesï¼‰
- ä» ACMS æ¥å£åŠ¨æ€è·å–é»‘åå•ç±»å‹
- æ ¼å¼ï¼š`code|name`ï¼ˆå¦‚ï¼š`parking_violation|è¿è§„é»‘åå•`ï¼‰

### 2. add-violation.vueï¼ˆæ·»åŠ è¿è§„è®°å½•é¡µé¢ï¼‰

#### å·²æœ‰åŠŸèƒ½ï¼š
âœ… **æäº¤è¿è§„è®°å½•**ï¼ˆsubmitViolation â†’ confirmSubmit â†’ submitToServerï¼‰
- æ”¶é›†è¡¨å•æ•°æ®
- è°ƒç”¨ `violationApi.createViolation()` æäº¤åˆ°åç«¯
- æ”¯æŒæ‰‹åŠ¨æ‹‰é»‘ï¼ˆä»…ç®¡ç†å‘˜è§’è‰²ï¼‰

âœ… **è½¦ä¸»ä¿¡æ¯æŸ¥è¯¢**
- æ ¹æ®è½¦ç‰Œå·æŸ¥è¯¢è½¦ä¸»ä¿¡æ¯
- åŒ…å«æœˆç¥¨ä¿¡æ¯ï¼ˆisMonthlyTicketã€ticketNameï¼‰

#### ç°æœ‰æ‹‰é»‘é€»è¾‘ï¼š
- ä»…ç®¡ç†å‘˜è§’è‰²å¯æ‰‹åŠ¨é€‰æ‹©æ˜¯å¦æ‹‰é»‘
- éœ€è¦å¡«å†™æ‹‰é»‘åŸå› ã€é€‰æ‹©é»‘åå•ç±»å‹
- åœ¨æäº¤æˆåŠŸåæ‰§è¡Œæ‹‰é»‘æ“ä½œ

---

## ğŸ¯ éœ€æ±‚å®ç°æ–¹æ¡ˆ

### æ–¹æ¡ˆ Aï¼šå‰ç«¯å®ç°è‡ªåŠ¨æ‹‰é»‘ï¼ˆæ¨èï¼‰â­

#### ä¼˜ç‚¹ï¼š
- å¿«é€Ÿå®ç°ï¼Œæ— éœ€ä¿®æ”¹åç«¯
- é€»è¾‘æ¸…æ™°ï¼Œæ˜“äºè°ƒè¯•
- å¯å¤ç”¨ç°æœ‰çš„å¤„ç†å’Œæ‹‰é»‘æ¥å£

#### å®ç°æ­¥éª¤ï¼š

#### 1ï¸âƒ£ IllegalRegiste.vue ä¿®æ”¹

**1.1 åœ¨è¡¨æ ¼ä¸­æ˜¾ç¤ºè¿è§„æ¬¡æ•°é¢„è­¦**

åœ¨"è½¦è¾†ä¿¡æ¯åˆ—"ä¸­å¢åŠ è¿è§„æ¬¡æ•°å¾½ç« ï¼š

```vue
<!-- åœ¨è½¦è¾†ä¿¡æ¯åˆ—ä¸­æ·»åŠ è¿è§„æ¬¡æ•°æ˜¾ç¤º -->
<el-table-column label="è½¦è¾†ä¿¡æ¯" width="200" fixed="left">
    <template #default="{ row }">
        <div class="vehicle-info-cell">
            <div class="vehicle-details">
                <div class="car-number-container">
                    <span :class="['plate-number', getPlateType(row.plateNumber)]">
                        {{ row.plateNumber }}
                    </span>
                    <!-- ğŸ†• è¿è§„æ¬¡æ•°å¾½ç«  -->
                    <el-badge 
                        v-if="row.violationCount && row.violationCount >= configForm.maxViolationCount - 2"
                        :value="row.violationCount" 
                        :type="row.violationCount >= configForm.maxViolationCount ? 'danger' : 'warning'"
                        :max="99"
                        class="violation-count-badge">
                    </el-badge>
                </div>
                <div class="owner-info">
                    <div class="owner-name">{{ row.ownerName || 'æœªçŸ¥' }}</div>
                    <!-- ğŸ†• å³å°†è‡ªåŠ¨æ‹‰é»‘æç¤º -->
                    <div v-if="row.violationCount >= configForm.maxViolationCount - 1" class="auto-blacklist-warning">
                        <el-icon><WarningFilled /></el-icon>
                        <span>å†è¿è§„{{ configForm.maxViolationCount - row.violationCount }}æ¬¡å°†è‡ªåŠ¨æ‹‰é»‘</span>
                    </div>
                </div>
            </div>
        </div>
    </template>
</el-table-column>
```

**1.2 åœ¨ getData() ä¸­è·å–æ¯ä¸ªè½¦ç‰Œçš„è¿è§„æ¬¡æ•°**

ä¿®æ”¹è·å–æ•°æ®é€»è¾‘ï¼Œä¸ºæ¯æ¡è®°å½•é™„åŠ è¿è§„æ¬¡æ•°ï¼š

```javascript
const getData = async () => {
    const params = {
        page: query.pageNum,
        size: query.pageSize,
        // ... å…¶ä»–å‚æ•°
    };

    try {
        const res = await violationApi.getViolations(params);
        
        if (res.data.data && res.data.data.records) {
            originalData.value = res.data.data.records;
            pageTotal.value = res.data.data.total || 0;
            
            // ğŸ†• ä¸ºæ¯æ¡è®°å½•æŸ¥è¯¢è¯¥è½¦ç‰Œçš„è¿è§„æ¬¡æ•°
            for (let record of originalData.value) {
                try {
                    const countResponse = await violationApi.getViolations({
                        plateNumber: record.plateNumber,
                        processStatus: 'pending', // åªç»Ÿè®¡æœªå¤„ç†çš„
                        page: 1,
                        size: 1
                    });
                    record.violationCount = countResponse.data?.data?.total || 0;
                } catch (error) {
                    console.error(`è·å–è½¦ç‰Œ${record.plateNumber}è¿è§„æ¬¡æ•°å¤±è´¥:`, error);
                    record.violationCount = 0;
                }
            }
            
            // åº”ç”¨å‰ç«¯è¿‡æ»¤
            applyFrontendFilter();
        }
    } catch (error) {
        console.error('è·å–è¿è§„æ•°æ®å¤±è´¥:', error);
        // ...
    }
};
```

**ä¼˜åŒ–æ–¹æ¡ˆï¼šæ‰¹é‡æŸ¥è¯¢è¿è§„æ¬¡æ•°**

ä¸ºäº†é¿å…å¤šæ¬¡è¯·æ±‚ï¼Œå¯ä»¥è€ƒè™‘ä¸€æ¬¡æ€§æŸ¥è¯¢æ‰€æœ‰è½¦ç‰Œçš„è¿è§„æ¬¡æ•°ï¼š

```javascript
// ğŸ†• æ‰¹é‡è·å–è¿è§„æ¬¡æ•°
const batchGetViolationCounts = async (plateNumbers) => {
    const counts = {};
    
    // ä½¿ç”¨ Promise.all å¹¶è¡ŒæŸ¥è¯¢
    await Promise.all(plateNumbers.map(async (plateNumber) => {
        try {
            const response = await violationApi.getViolations({
                plateNumber: plateNumber,
                processStatus: 'pending',
                page: 1,
                size: 1
            });
            counts[plateNumber] = response.data?.data?.total || 0;
        } catch (error) {
            console.error(`è·å–è½¦ç‰Œ${plateNumber}è¿è§„æ¬¡æ•°å¤±è´¥:`, error);
            counts[plateNumber] = 0;
        }
    }));
    
    return counts;
};

const getData = async () => {
    // ... åŸæœ‰é€»è¾‘
    
    if (res.data.data && res.data.data.records) {
        originalData.value = res.data.data.records;
        
        // ğŸ†• æ‰¹é‡è·å–è¿è§„æ¬¡æ•°
        const plateNumbers = [...new Set(originalData.value.map(r => r.plateNumber))];
        const violationCounts = await batchGetViolationCounts(plateNumbers);
        
        // é™„åŠ è¿è§„æ¬¡æ•°åˆ°è®°å½•
        originalData.value.forEach(record => {
            record.violationCount = violationCounts[record.plateNumber] || 0;
        });
        
        applyFrontendFilter();
    }
};
```

#### 2ï¸âƒ£ add-violation.vue ä¿®æ”¹

**2.1 åœ¨æäº¤å‰æ£€æŸ¥è¿è§„æ¬¡æ•°å¹¶è§¦å‘è‡ªåŠ¨æ‹‰é»‘**

ä¿®æ”¹ `confirmSubmit` æ–¹æ³•ï¼š

```javascript
// ç¡®è®¤æäº¤
async confirmSubmit() {
    this.submitting = true;
    try {
        // 1ï¸âƒ£ å…ˆæäº¤è¿è§„è®°å½•åˆ°æ•°æ®åº“
        const result = await this.submitToServer();
        
        // 2ï¸âƒ£ ğŸ†• æ£€æŸ¥æ˜¯å¦è¾¾åˆ°è‡ªåŠ¨æ‹‰é»‘é˜ˆå€¼
        const shouldAutoBlacklist = await this.checkAutoBlacklistThreshold(this.formData.plateNumber);
        
        if (shouldAutoBlacklist) {
            // è§¦å‘è‡ªåŠ¨æ‹‰é»‘
            await this.performAutoBlacklist(this.formData.plateNumber);
        }
        
        // 3ï¸âƒ£ å‘é€çŸ­ä¿¡é€šçŸ¥ï¼ˆå¦‚æœæœ‰è½¦ä¸»ç”µè¯ï¼‰
        if (this.ownerInfo && this.ownerInfo.phone && this.ownerInfo.phone !== 'æœªç™»è®°' && this.ownerInfo.phone.match(/^1[3-9]\d{9}$/)) {
            // ... åŸæœ‰çŸ­ä¿¡é€»è¾‘
        } else {
            this.showSubmitSuccessModal(result);
        }
        
        // 4ï¸âƒ£ æ‰‹åŠ¨æ‹‰é»‘é€»è¾‘ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
        if (this.shouldShowBlacklistSection && this.formData.shouldBlacklist) {
            await this.handleBlacklist();
        }
        
    } catch (error) {
        // ... é”™è¯¯å¤„ç†
    } finally {
        this.submitting = false;
        this.closeConfirmModal();
    }
},
```

**2.2 å®ç°è‡ªåŠ¨æ‹‰é»‘æ£€æŸ¥é€»è¾‘**

```javascript
/**
 * ğŸ†• æ£€æŸ¥æ˜¯å¦è¾¾åˆ°è‡ªåŠ¨æ‹‰é»‘é˜ˆå€¼
 * @param {String} plateNumber è½¦ç‰Œå·
 * @returns {Boolean} æ˜¯å¦è¾¾åˆ°é˜ˆå€¼
 */
async checkAutoBlacklistThreshold(plateNumber) {
    try {
        // è·å–æœˆç¥¨è½¦é…ç½®ï¼ˆåŒ…å«é˜ˆå€¼ï¼‰
        const configResponse = await violationApi.getMonthlyTicketConfig('2KPL6XFF');
        if (!configResponse.data || configResponse.data.code !== 0) {
            console.warn('âš ï¸ è·å–æœˆç¥¨è½¦é…ç½®å¤±è´¥ï¼Œè·³è¿‡è‡ªåŠ¨æ‹‰é»‘æ£€æŸ¥');
            return false;
        }
        
        const config = configResponse.data.data;
        const threshold = config.maxViolationCount || 5; // é»˜è®¤5æ¬¡
        
        // æŸ¥è¯¢è¯¥è½¦ç‰Œçš„æœªå¤„ç†è¿è§„è®°å½•æ•°é‡
        const violationResponse = await violationApi.getViolations({
            plateNumber: plateNumber,
            processStatus: 'pending',
            page: 1,
            size: 1 // åªéœ€è¦æ€»æ•°
        });
        
        const violationCount = violationResponse.data?.data?.total || 0;
        
        console.log(`ğŸš— [è‡ªåŠ¨æ‹‰é»‘æ£€æŸ¥] è½¦ç‰Œï¼š${plateNumber}ï¼Œè¿è§„æ¬¡æ•°ï¼š${violationCount}/${threshold}`);
        
        // å¦‚æœè¾¾åˆ°æˆ–è¶…è¿‡é˜ˆå€¼ï¼Œè§¦å‘è‡ªåŠ¨æ‹‰é»‘
        return violationCount >= threshold;
        
    } catch (error) {
        console.error('âŒ æ£€æŸ¥è‡ªåŠ¨æ‹‰é»‘é˜ˆå€¼å¤±è´¥:', error);
        return false;
    }
},

/**
 * ğŸ†• æ‰§è¡Œè‡ªåŠ¨æ‹‰é»‘
 * @param {String} plateNumber è½¦ç‰Œå·
 */
async performAutoBlacklist(plateNumber) {
    try {
        console.log(`ğŸš« [è‡ªåŠ¨æ‹‰é»‘] å¼€å§‹æ‰§è¡Œè‡ªåŠ¨æ‹‰é»‘ï¼š${plateNumber}`);
        
        // 1. è·å–é»‘åå•ç±»å‹ï¼ˆä»ACMSæ¥å£ï¼‰
        const blacklistTypesResponse = await violationApi.getBlacklistTypes('ä¸œåŒ—æ—ä¸šå¤§å­¦');
        let blacklistType = 'parking_violation|è¿è§„é»‘åå•'; // é»˜è®¤ç±»å‹
        
        if (blacklistTypesResponse.data?.code === "0") {
            const types = blacklistTypesResponse.data.data.blacklistTypes || [];
            if (types.length > 0) {
                // ä½¿ç”¨ç¬¬ä¸€ä¸ªé»‘åå•ç±»å‹
                blacklistType = `${types[0].code}|${types[0].name}`;
            }
        }
        
        // 2. æ„å»ºå¤„ç†å‚æ•°ï¼ˆè‡ªåŠ¨æ‹‰é»‘ï¼‰
        const processParams = {
            processRemark: 'ç³»ç»Ÿè‡ªåŠ¨æ‹‰é»‘ï¼šè¿è§„æ¬¡æ•°è¾¾åˆ°é˜ˆå€¼',
            operatorName: 'ç³»ç»Ÿè‡ªåŠ¨',
            shouldBlacklist: true,
            blacklistType: blacklistType,
            blacklistReason: `è¿è§„åœè½¦ç´¯è®¡è¾¾åˆ°${violationCount}æ¬¡ï¼Œç³»ç»Ÿè‡ªåŠ¨æ‹‰é»‘`,
            isPermanent: true, // é»˜è®¤æ°¸ä¹…æ‹‰é»‘ï¼ˆå¯æ ¹æ®éœ€æ±‚è°ƒæ•´ï¼‰
            blacklistStartTime: null,
            blacklistEndTime: null,
            processType: 'auto_blacklist' // ğŸ”‘ æ ‡è®°ä¸ºè‡ªåŠ¨æ‹‰é»‘
        };
        
        // 3. è°ƒç”¨æ‰¹é‡å¤„ç†æ¥å£ï¼Œå¤„ç†è¯¥è½¦ç‰Œçš„æ‰€æœ‰æœªå¤„ç†è¿è§„è®°å½•
        const response = await violationApi.processAllViolationsByPlate(
            plateNumber,
            processParams
        );
        
        if (response.data && response.data.code === '0') {
            console.log(`âœ… [è‡ªåŠ¨æ‹‰é»‘] æˆåŠŸï¼š${plateNumber}`);
            
            // æ˜¾ç¤ºè‡ªåŠ¨æ‹‰é»‘æˆåŠŸæç¤º
            uni.showModal({
                title: 'ç³»ç»Ÿè‡ªåŠ¨æ‹‰é»‘',
                content: `è½¦ç‰Œ ${plateNumber} å› è¿è§„æ¬¡æ•°è¾¾åˆ°é˜ˆå€¼ï¼Œå·²è¢«ç³»ç»Ÿè‡ªåŠ¨åŠ å…¥é»‘åå•`,
                showCancel: false,
                confirmText: 'çŸ¥é“äº†'
            });
        } else {
            throw new Error(response.data?.msg || 'è‡ªåŠ¨æ‹‰é»‘å¤±è´¥');
        }
        
    } catch (error) {
        console.error('âŒ [è‡ªåŠ¨æ‹‰é»‘] å¤±è´¥:', error);
        
        // è‡ªåŠ¨æ‹‰é»‘å¤±è´¥ä¸å½±å“è¿è§„è®°å½•çš„æäº¤ï¼Œåªæç¤ºè­¦å‘Š
        uni.showModal({
            title: 'è‡ªåŠ¨æ‹‰é»‘å¤±è´¥',
            content: `è¿è§„è®°å½•å·²æäº¤ï¼Œä½†è‡ªåŠ¨æ‹‰é»‘æ“ä½œå¤±è´¥ï¼š${error.message}`,
            showCancel: false,
            confirmText: 'çŸ¥é“äº†'
        });
    }
},
```

**2.3 ä¼˜åŒ–ï¼šåœ¨è½¦ä¸»ä¿¡æ¯ä¸­æ˜¾ç¤ºè¿è§„æ¬¡æ•°é¢„è­¦**

åœ¨æŸ¥è¯¢è½¦ä¸»ä¿¡æ¯åï¼Œæ˜¾ç¤ºè¿è§„æ¬¡æ•°è­¦å‘Šï¼š

```javascript
// åœ¨ queryOwnerInfo æˆ–ç›¸å…³æ–¹æ³•ä¸­æ·»åŠ 
async queryOwnerInfo(plateNumber) {
    try {
        // ... åŸæœ‰æŸ¥è¯¢é€»è¾‘
        
        // ğŸ†• æŸ¥è¯¢è¿è§„æ¬¡æ•°
        const violationResponse = await violationApi.getViolations({
            plateNumber: plateNumber,
            processStatus: 'pending',
            page: 1,
            size: 1
        });
        
        const violationCount = violationResponse.data?.data?.total || 0;
        
        // ğŸ†• æŸ¥è¯¢é…ç½®é˜ˆå€¼
        const configResponse = await violationApi.getMonthlyTicketConfig('2KPL6XFF');
        const threshold = configResponse.data?.data?.maxViolationCount || 5;
        
        // å¦‚æœæ¥è¿‘é˜ˆå€¼ï¼Œæ˜¾ç¤ºè­¦å‘Š
        if (violationCount >= threshold - 2 && violationCount < threshold) {
            uni.showModal({
                title: 'è¿è§„æ¬¡æ•°é¢„è­¦',
                content: `è¯¥è½¦è¾†å·²æœ‰ ${violationCount} æ¬¡è¿è§„è®°å½•ï¼Œå†è¿è§„ ${threshold - violationCount} æ¬¡å°†è¢«ç³»ç»Ÿè‡ªåŠ¨æ‹‰é»‘`,
                showCancel: false,
                confirmText: 'çŸ¥é“äº†'
            });
        }
        
    } catch (error) {
        console.error('æŸ¥è¯¢è½¦ä¸»ä¿¡æ¯å¤±è´¥:', error);
    }
}
```

---

### æ–¹æ¡ˆ Bï¼šåç«¯å®ç°è‡ªåŠ¨æ‹‰é»‘

#### ä¼˜ç‚¹ï¼š
- é€»è¾‘é›†ä¸­åœ¨åç«¯ï¼Œæ›´å®‰å…¨å¯é 
- å‰ç«¯è°ƒç”¨ç®€å•
- æ˜“äºç»Ÿä¸€ç®¡ç†å’Œæ‰©å±•

#### å®ç°æ­¥éª¤ï¼š

#### 1ï¸âƒ£ åç«¯æ–°å¢æ¥å£ï¼ˆéœ€è¦åç«¯å¼€å‘ï¼‰

**Java åç«¯å®ç°ï¼ˆç¤ºä¾‹ï¼‰ï¼š**

```java
// ViolationController.java

/**
 * åˆ›å»ºè¿è§„è®°å½•ï¼ˆæ”¯æŒè‡ªåŠ¨æ‹‰é»‘æ£€æŸ¥ï¼‰
 */
@PostMapping
public ResponseEntity<?> createViolation(@RequestBody Violation violation) {
    try {
        // 1. ä¿å­˜è¿è§„è®°å½•
        Violation savedViolation = violationService.save(violation);
        
        // 2. æ£€æŸ¥æ˜¯å¦è¾¾åˆ°è‡ªåŠ¨æ‹‰é»‘é˜ˆå€¼
        boolean shouldAutoBlacklist = violationService.checkAutoBlacklistThreshold(
            violation.getPlateNumber()
        );
        
        if (shouldAutoBlacklist) {
            // 3. æ‰§è¡Œè‡ªåŠ¨æ‹‰é»‘
            violationService.performAutoBlacklist(violation.getPlateNumber());
        }
        
        return ResponseEntity.ok(savedViolation);
    } catch (Exception e) {
        return ResponseEntity.status(500).body("åˆ›å»ºè¿è§„è®°å½•å¤±è´¥ï¼š" + e.getMessage());
    }
}
```

```java
// ViolationService.java

/**
 * æ£€æŸ¥æ˜¯å¦è¾¾åˆ°è‡ªåŠ¨æ‹‰é»‘é˜ˆå€¼
 */
public boolean checkAutoBlacklistThreshold(String plateNumber) {
    // è·å–é…ç½®é˜ˆå€¼
    MonthlyTicketConfig config = configRepository.findByParkCode("2KPL6XFF");
    int threshold = config != null ? config.getMaxViolationCount() : 5;
    
    // æŸ¥è¯¢æœªå¤„ç†è¿è§„è®°å½•æ•°é‡
    long count = violationRepository.countByPlateNumberAndProcessStatus(
        plateNumber, "pending"
    );
    
    return count >= threshold;
}

/**
 * æ‰§è¡Œè‡ªåŠ¨æ‹‰é»‘
 */
public void performAutoBlacklist(String plateNumber) {
    // 1. æŸ¥è¯¢è¯¥è½¦ç‰Œçš„æ‰€æœ‰æœªå¤„ç†è¿è§„è®°å½•
    List<Violation> violations = violationRepository.findByPlateNumberAndProcessStatus(
        plateNumber, "pending"
    );
    
    // 2. æ‰¹é‡æ›´æ–°ä¸ºå·²å¤„ç†
    violations.forEach(v -> {
        v.setProcessStatus("processed");
        v.setProcessType("auto_blacklist");
        v.setProcessedBy("ç³»ç»Ÿè‡ªåŠ¨");
        v.setProcessedAt(new Date());
        v.setProcessRemark("ç³»ç»Ÿè‡ªåŠ¨æ‹‰é»‘ï¼šè¿è§„æ¬¡æ•°è¾¾åˆ°é˜ˆå€¼");
    });
    violationRepository.saveAll(violations);
    
    // 3. è°ƒç”¨é»‘åå•æ¥å£ï¼ˆACMSï¼‰
    blacklistService.addToBlacklist(
        plateNumber,
        "parking_violation",
        "è¿è§„åœè½¦ç´¯è®¡è¾¾åˆ°é˜ˆå€¼ï¼Œç³»ç»Ÿè‡ªåŠ¨æ‹‰é»‘",
        true, // æ°¸ä¹…æ‹‰é»‘
        null,
        null
    );
}
```

#### 2ï¸âƒ£ å‰ç«¯è°ƒç”¨ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰

ä½¿ç”¨ç°æœ‰çš„ `violationApi.createViolation()` æ¥å£å³å¯ï¼Œåç«¯ä¼šè‡ªåŠ¨æ£€æŸ¥å’Œæ‰§è¡Œæ‹‰é»‘ã€‚

---

## ğŸ“Š æ•°æ®æµç¨‹å›¾

### å‰ç«¯æ–¹æ¡ˆï¼ˆæ–¹æ¡ˆ Aï¼‰

```
ç”¨æˆ·æ·»åŠ è¿è§„è®°å½•
    â†“
submitViolation() - éªŒè¯è¡¨å•
    â†“
confirmSubmit() - ç¡®è®¤æäº¤
    â†“
submitToServer() - æäº¤åˆ°åç«¯
    â†“
âœ… è¿è§„è®°å½•ä¿å­˜æˆåŠŸ
    â†“
checkAutoBlacklistThreshold() - æ£€æŸ¥è¿è§„æ¬¡æ•°
    â†“
æ˜¯å¦è¾¾åˆ°é˜ˆå€¼ï¼Ÿ
    â”œâ”€ æ˜¯ â†’ performAutoBlacklist() 
    â”‚         â”œâ”€ è·å–é»‘åå•ç±»å‹
    â”‚         â”œâ”€ æ„å»ºå¤„ç†å‚æ•°
    â”‚         â””â”€ è°ƒç”¨ processAllViolationsByPlate()
    â”‚             â”œâ”€ æ‰¹é‡å¤„ç†æ‰€æœ‰æœªå¤„ç†è¿è§„è®°å½•
    â”‚             â”œâ”€ è®¾ç½® processType = 'auto_blacklist'
    â”‚             â””â”€ è°ƒç”¨ACMSé»‘åå•æ¥å£
    â”‚                 â””â”€ âœ… è‡ªåŠ¨æ‹‰é»‘å®Œæˆ
    â””â”€ å¦ â†’ ç»§ç»­æ­£å¸¸æµç¨‹
         â†“
    å‘é€çŸ­ä¿¡é€šçŸ¥ï¼ˆå¯é€‰ï¼‰
         â†“
    showSubmitSuccessModal() - æ˜¾ç¤ºæˆåŠŸæç¤º
```

### åç«¯æ–¹æ¡ˆï¼ˆæ–¹æ¡ˆ Bï¼‰

```
ç”¨æˆ·æ·»åŠ è¿è§„è®°å½•
    â†“
submitViolation() - å‰ç«¯éªŒè¯
    â†“
violationApi.createViolation() - è°ƒç”¨åç«¯API
    â†“
åç«¯æ¥æ”¶è¯·æ±‚
    â”œâ”€ ä¿å­˜è¿è§„è®°å½•
    â”œâ”€ æ£€æŸ¥è¿è§„æ¬¡æ•°
    â””â”€ æ˜¯å¦è¾¾åˆ°é˜ˆå€¼ï¼Ÿ
        â”œâ”€ æ˜¯ â†’ æ‰§è¡Œè‡ªåŠ¨æ‹‰é»‘
        â”‚      â”œâ”€ æ‰¹é‡å¤„ç†è¿è§„è®°å½•
        â”‚      â””â”€ è°ƒç”¨ACMSé»‘åå•æ¥å£
        â””â”€ å¦ â†’ ç›´æ¥è¿”å›
    â†“
è¿”å›ç»“æœç»™å‰ç«¯
    â†“
å‰ç«¯æ˜¾ç¤ºæˆåŠŸæç¤º
```

---

## ğŸ› ï¸ éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

### æ–¹æ¡ˆ Aï¼ˆå‰ç«¯å®ç°ï¼‰

#### 1. manage-front/src/views/admin/IllegalRegiste.vue

**ä¿®æ”¹å†…å®¹ï¼š**
- âœ… åœ¨è¡¨æ ¼"è½¦è¾†ä¿¡æ¯åˆ—"ä¸­æ˜¾ç¤ºè¿è§„æ¬¡æ•°å¾½ç« 
- âœ… åœ¨ getData() ä¸­æ‰¹é‡æŸ¥è¯¢è¿è§„æ¬¡æ•°
- âœ… æ·»åŠ  batchGetViolationCounts() è¾…åŠ©å‡½æ•°
- âœ… æ·»åŠ æ ·å¼ï¼ˆè¿è§„æ¬¡æ•°å¾½ç« ã€è‡ªåŠ¨æ‹‰é»‘è­¦å‘Šï¼‰

**æ–°å¢æ–¹æ³•ï¼š**
```javascript
// æ‰¹é‡è·å–è¿è§„æ¬¡æ•°
const batchGetViolationCounts = async (plateNumbers) => { ... }
```

#### 2. violation-of-stop-inspection/pages/violation/add-violation.vue

**ä¿®æ”¹å†…å®¹ï¼š**
- âœ… ä¿®æ”¹ confirmSubmit() æ–¹æ³•ï¼Œåœ¨æäº¤åæ£€æŸ¥è‡ªåŠ¨æ‹‰é»‘
- âœ… æ·»åŠ  checkAutoBlacklistThreshold() æ–¹æ³•
- âœ… æ·»åŠ  performAutoBlacklist() æ–¹æ³•
- âœ… åœ¨è½¦ä¸»ä¿¡æ¯ä¸­æ˜¾ç¤ºè¿è§„æ¬¡æ•°é¢„è­¦

**æ–°å¢æ–¹æ³•ï¼š**
```javascript
// æ£€æŸ¥æ˜¯å¦è¾¾åˆ°è‡ªåŠ¨æ‹‰é»‘é˜ˆå€¼
async checkAutoBlacklistThreshold(plateNumber) { ... }

// æ‰§è¡Œè‡ªåŠ¨æ‹‰é»‘
async performAutoBlacklist(plateNumber) { ... }
```

#### 3. manage-front/src/api/violation.js

**å¯é€‰ä¿®æ”¹ï¼š**
- âœ… å¦‚æœéœ€è¦ä¼˜åŒ–ï¼Œå¯ä»¥æ·»åŠ æ‰¹é‡æŸ¥è¯¢è¿è§„æ¬¡æ•°çš„æ¥å£

```javascript
// ğŸ†• æ‰¹é‡æŸ¥è¯¢è½¦ç‰Œè¿è§„æ¬¡æ•°
batchGetViolationCounts(plateNumbers) {
    return request({
        url: '/parking/violations/batch-counts',
        method: 'post',
        data: { plateNumbers }
    })
}
```

---

### æ–¹æ¡ˆ Bï¼ˆåç«¯å®ç°ï¼‰

#### 1. parking-demo/src/main/java/com/parkingmanage/controller/ViolationController.java

**ä¿®æ”¹å†…å®¹ï¼š**
- âœ… ä¿®æ”¹ createViolation() æ–¹æ³•ï¼Œåœ¨ä¿å­˜åæ£€æŸ¥è‡ªåŠ¨æ‹‰é»‘

#### 2. parking-demo/src/main/java/com/parkingmanage/service/impl/ViolationServiceImpl.java

**æ–°å¢æ–¹æ³•ï¼š**
```java
// æ£€æŸ¥æ˜¯å¦è¾¾åˆ°è‡ªåŠ¨æ‹‰é»‘é˜ˆå€¼
public boolean checkAutoBlacklistThreshold(String plateNumber) { ... }

// æ‰§è¡Œè‡ªåŠ¨æ‹‰é»‘
public void performAutoBlacklist(String plateNumber) { ... }
```

#### 3. manage-front/src/views/admin/IllegalRegiste.vue

**ä¿®æ”¹å†…å®¹ï¼š**
- âœ… åœ¨è¡¨æ ¼ä¸­æ˜¾ç¤ºè¿è§„æ¬¡æ•°ï¼ˆåŒæ–¹æ¡ˆAï¼‰
- âœ… åœ¨ getData() ä¸­æ‰¹é‡æŸ¥è¯¢è¿è§„æ¬¡æ•°ï¼ˆåŒæ–¹æ¡ˆAï¼‰

---

## ğŸ¨ UI å±•ç¤ºæ•ˆæœ

### IllegalRegiste.vue è¡¨æ ¼å±•ç¤º

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è½¦ç‰Œå·ç           â”‚ è½¦ä¸»å§“å    â”‚ è¿è§„ä¿¡æ¯       â”‚ æ“ä½œ    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”µ é»‘A12345       â”‚ å¼ ä¸‰        â”‚ è¶…æ—¶åœè½¦       â”‚ [è¯¦æƒ…] â”‚
â”‚ ğŸ”´ 4 (è­¦å‘Š)       â”‚             â”‚ 2025-10-06    â”‚ [å¤„ç†] â”‚
â”‚ å†è¿è§„1æ¬¡è‡ªåŠ¨æ‹‰é»‘  â”‚             â”‚               â”‚        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸŸ¢ é»‘AF57913      â”‚ æå››        â”‚ å ç”¨è½¦ä½       â”‚ [è¯¦æƒ…] â”‚
â”‚ ğŸŸ  2 (æ­£å¸¸)       â”‚             â”‚ 2025-10-05    â”‚ [å¤„ç†] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”µ é»‘B67890       â”‚ ç‹äº”        â”‚ è¿è§„åœè½¦       â”‚ [è¯¦æƒ…] â”‚
â”‚ ğŸ”´ 5 (å·²è¾¾é˜ˆå€¼)   â”‚             â”‚ 2025-10-04    â”‚ å·²å¤„ç† â”‚
â”‚ âœ… ç³»ç»Ÿå·²è‡ªåŠ¨æ‹‰é»‘  â”‚             â”‚               â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### add-violation.vue æç¤ºæ•ˆæœ

**åœºæ™¯1ï¼šæ¥è¿‘é˜ˆå€¼**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       è¿è§„æ¬¡æ•°é¢„è­¦                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¯¥è½¦è¾†å·²æœ‰ 4 æ¬¡è¿è§„è®°å½•ï¼Œ          â”‚
â”‚  å†è¿è§„ 1 æ¬¡å°†è¢«ç³»ç»Ÿè‡ªåŠ¨æ‹‰é»‘        â”‚
â”‚                                     â”‚
â”‚            [çŸ¥é“äº†]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åœºæ™¯2ï¼šè§¦å‘è‡ªåŠ¨æ‹‰é»‘**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       ç³»ç»Ÿè‡ªåŠ¨æ‹‰é»‘                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è½¦ç‰Œ é»‘A12345 å› è¿è§„æ¬¡æ•°è¾¾åˆ°é˜ˆå€¼ï¼Œ  â”‚
â”‚  å·²è¢«ç³»ç»Ÿè‡ªåŠ¨åŠ å…¥é»‘åå•             â”‚
â”‚                                     â”‚
â”‚            [çŸ¥é“äº†]                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### è‡ªåŠ¨æ‹‰é»‘é…ç½®å‚æ•°

åœ¨ `IllegalRegiste.vue` çš„æœˆç¥¨è½¦é…ç½®ä¸­ï¼š

```javascript
const configForm = reactive({
    parkCode: "2KPL6XFF",
    timeoutMinutes: 60,                // è¶…æ—¶æ—¶é—´
    maxViolationCount: 5,              // ğŸ”‘ ç´¯è®¡æ¬¡æ•°é˜ˆå€¼ï¼ˆè‡ªåŠ¨æ‹‰é»‘ï¼‰
    overnightTimeHours: 4,             // è¿‡å¤œæ—¶é—´
    exemptTicketTypes: ''              // å…æ£€ç±»å‹
});
```

**é…ç½®è¯´æ˜ï¼š**
- `maxViolationCount`ï¼šè¿è§„ç´¯è®¡æ¬¡æ•°é˜ˆå€¼
  - é»˜è®¤å€¼ï¼š5æ¬¡
  - å½“æŸè½¦ç‰Œçš„æœªå¤„ç†è¿è§„è®°å½•è¾¾åˆ°æ­¤æ•°é‡æ—¶ï¼Œè§¦å‘è‡ªåŠ¨æ‹‰é»‘
  - å¯åœ¨"æœˆç¥¨è½¦è¶…æ—¶é…ç½®"å¼¹çª—ä¸­ä¿®æ”¹

### è‡ªåŠ¨æ‹‰é»‘è¡Œä¸ºé…ç½®

```javascript
const autoBlacklistConfig = {
    // æ‹‰é»‘ç±»å‹ï¼ˆä»ACMSåŠ¨æ€è·å–ï¼‰
    blacklistType: 'parking_violation|è¿è§„é»‘åå•',
    
    // æ‹‰é»‘æ—¶é•¿ï¼ˆå¯æ ¹æ®éœ€æ±‚è°ƒæ•´ï¼‰
    isPermanent: true,  // true=æ°¸ä¹…æ‹‰é»‘, false=ä¸´æ—¶æ‹‰é»‘
    
    // æ‹‰é»‘åŸå› æ¨¡æ¿
    reasonTemplate: 'è¿è§„åœè½¦ç´¯è®¡è¾¾åˆ°{count}æ¬¡ï¼Œç³»ç»Ÿè‡ªåŠ¨æ‹‰é»‘',
    
    // å¤„ç†æ ‡è®°
    processType: 'auto_blacklist',  // æ ‡è®°ä¸ºç³»ç»Ÿè‡ªåŠ¨æ‹‰é»‘
    operatorName: 'ç³»ç»Ÿè‡ªåŠ¨',        // å¤„ç†äºº
    
    // æ˜¯å¦æ˜¾ç¤ºç¡®è®¤å¼¹çª—ï¼ˆå¯é€‰ï¼‰
    showConfirmModal: true
};
```

---

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯•ç”¨ä¾‹ 1ï¼šæ­£å¸¸è¿è§„è®°å½•æ·»åŠ ï¼ˆæœªè¾¾é˜ˆå€¼ï¼‰

**å‰ç½®æ¡ä»¶ï¼š**
- è½¦ç‰Œ `é»‘A12345` å½“å‰æœ‰ 2 æ¬¡æœªå¤„ç†è¿è§„è®°å½•
- é˜ˆå€¼è®¾ç½®ä¸º 5 æ¬¡

**æ“ä½œæ­¥éª¤ï¼š**
1. æ‰“å¼€ add-violation.vue é¡µé¢
2. è¾“å…¥è½¦ç‰Œå· `é»‘A12345`
3. å¡«å†™è¿è§„ä¿¡æ¯
4. ç‚¹å‡»æäº¤

**é¢„æœŸç»“æœï¼š**
- âœ… è¿è§„è®°å½•æˆåŠŸæäº¤
- âœ… ä¸è§¦å‘è‡ªåŠ¨æ‹‰é»‘
- âœ… æç¤º"è¿è§„è®°å½•å·²æˆåŠŸæäº¤"

### æµ‹è¯•ç”¨ä¾‹ 2ï¼šè¾¾åˆ°é˜ˆå€¼è§¦å‘è‡ªåŠ¨æ‹‰é»‘

**å‰ç½®æ¡ä»¶ï¼š**
- è½¦ç‰Œ `é»‘B67890` å½“å‰æœ‰ 4 æ¬¡æœªå¤„ç†è¿è§„è®°å½•
- é˜ˆå€¼è®¾ç½®ä¸º 5 æ¬¡

**æ“ä½œæ­¥éª¤ï¼š**
1. æ‰“å¼€ add-violation.vue é¡µé¢
2. è¾“å…¥è½¦ç‰Œå· `é»‘B67890`
3. æŸ¥è¯¢è½¦ä¸»ä¿¡æ¯æ—¶æ˜¾ç¤ºè­¦å‘Šï¼š"å†è¿è§„ 1 æ¬¡å°†è¢«ç³»ç»Ÿè‡ªåŠ¨æ‹‰é»‘"
4. å¡«å†™è¿è§„ä¿¡æ¯
5. ç‚¹å‡»æäº¤

**é¢„æœŸç»“æœï¼š**
- âœ… è¿è§„è®°å½•æˆåŠŸæäº¤
- âœ… è§¦å‘è‡ªåŠ¨æ‹‰é»‘
- âœ… è¯¥è½¦ç‰Œçš„æ‰€æœ‰ 5 æ¡æœªå¤„ç†è¿è§„è®°å½•è¢«æ ‡è®°ä¸º"å·²å¤„ç†"
- âœ… processType = 'auto_blacklist'
- âœ… processedBy = 'ç³»ç»Ÿè‡ªåŠ¨'
- âœ… è½¦ç‰Œè¢«åŠ å…¥ACMSé»‘åå•
- âœ… æ˜¾ç¤º"ç³»ç»Ÿè‡ªåŠ¨æ‹‰é»‘"æç¤ºå¼¹çª—

### æµ‹è¯•ç”¨ä¾‹ 3ï¼šIllegalRegiste.vue æ˜¾ç¤ºè¿è§„æ¬¡æ•°

**å‰ç½®æ¡ä»¶ï¼š**
- æ•°æ®åº“ä¸­å­˜åœ¨å¤šæ¡è¿è§„è®°å½•

**æ“ä½œæ­¥éª¤ï¼š**
1. æ‰“å¼€ IllegalRegiste.vue é¡µé¢
2. æŸ¥çœ‹è¿è§„è®°å½•åˆ—è¡¨

**é¢„æœŸç»“æœï¼š**
- âœ… æ¯æ¡è®°å½•æ˜¾ç¤ºå¯¹åº”è½¦ç‰Œçš„è¿è§„æ¬¡æ•°å¾½ç« 
- âœ… æ¥è¿‘é˜ˆå€¼çš„è®°å½•æ˜¾ç¤ºè­¦å‘Šé¢œè‰²ï¼ˆæ©™è‰²ï¼‰
- âœ… è¾¾åˆ°é˜ˆå€¼çš„è®°å½•æ˜¾ç¤ºå±é™©é¢œè‰²ï¼ˆçº¢è‰²ï¼‰
- âœ… æ˜¾ç¤º"å†è¿è§„Xæ¬¡è‡ªåŠ¨æ‹‰é»‘"æç¤º

### æµ‹è¯•ç”¨ä¾‹ 4ï¼šè‡ªåŠ¨æ‹‰é»‘å¤±è´¥å¤„ç†

**å‰ç½®æ¡ä»¶ï¼š**
- è½¦ç‰Œ `é»‘C11111` å½“å‰æœ‰ 4 æ¬¡æœªå¤„ç†è¿è§„è®°å½•
- ACMSé»‘åå•æ¥å£æš‚æ—¶ä¸å¯ç”¨

**æ“ä½œæ­¥éª¤ï¼š**
1. æ·»åŠ è¯¥è½¦ç‰Œçš„ç¬¬5æ¡è¿è§„è®°å½•
2. è§¦å‘è‡ªåŠ¨æ‹‰é»‘é€»è¾‘

**é¢„æœŸç»“æœï¼š**
- âœ… è¿è§„è®°å½•æˆåŠŸæäº¤
- âœ… å°è¯•è‡ªåŠ¨æ‹‰é»‘ä½†å¤±è´¥
- âŒ è¿è§„è®°å½•æœªè¢«æ ‡è®°ä¸ºå·²å¤„ç†
- âœ… æ˜¾ç¤º"è‡ªåŠ¨æ‹‰é»‘å¤±è´¥"æç¤º
- âœ… ä¸å½±å“è¿è§„è®°å½•çš„æ­£å¸¸æäº¤

---

## ğŸ“ åç»­ä¼˜åŒ–å»ºè®®

### 1. è‡ªåŠ¨æ‹‰é»‘è§„åˆ™é…ç½®åŒ–

**å½“å‰ï¼š** é˜ˆå€¼å›ºå®šä¸º `maxViolationCount`

**ä¼˜åŒ–ï¼š** æ”¯æŒæ›´çµæ´»çš„è§„åˆ™é…ç½®

```javascript
const autoBlacklistRules = {
    // è§„åˆ™1ï¼šç´¯è®¡è¿è§„æ¬¡æ•°
    violationCount: {
        enabled: true,
        threshold: 5,
        timeWindow: 30 // 30å¤©å†…
    },
    
    // è§„åˆ™2ï¼šä¸¥é‡è¿è§„ç±»å‹
    severityTypes: {
        enabled: true,
        types: ['fire_lane', 'disabled_space'], // å ç”¨æ¶ˆé˜²é€šé“ã€å ç”¨æ®‹ç–¾äººè½¦ä½
        threshold: 2 // ä¸¥é‡è¿è§„2æ¬¡å³æ‹‰é»‘
    },
    
    // è§„åˆ™3ï¼šä¿¡ç”¨åˆ†ä½äºé˜ˆå€¼
    creditScore: {
        enabled: true,
        threshold: 60
    }
};
```

### 2. è‡ªåŠ¨æ‹‰é»‘é€šçŸ¥

**ä¼˜åŒ–ï¼š** æ‹‰é»‘åè‡ªåŠ¨å‘é€é€šçŸ¥

- çŸ­ä¿¡é€šçŸ¥è½¦ä¸»
- é‚®ä»¶é€šçŸ¥ç®¡ç†å‘˜
- ç³»ç»Ÿæ¶ˆæ¯æ¨é€

### 3. è‡ªåŠ¨æ‹‰é»‘æ—¥å¿—

**ä¼˜åŒ–ï¼š** è®°å½•è¯¦ç»†çš„è‡ªåŠ¨æ‹‰é»‘æ—¥å¿—

```javascript
const autoBlacklistLog = {
    plateNumber: 'é»‘A12345',
    triggerTime: '2025-10-06 14:30:00',
    violationCount: 5,
    threshold: 5,
    blacklistType: 'parking_violation',
    processedViolations: [101, 102, 103, 104, 105],
    acmsResponse: { ... },
    status: 'success' // success / failed
};
```

### 4. è‡ªåŠ¨æ‹‰é»‘ç™½åå•

**ä¼˜åŒ–ï¼š** æŸäº›ç‰¹æ®Šè½¦è¾†ä¸è‡ªåŠ¨æ‹‰é»‘

```javascript
const autoBlacklistWhitelist = [
    'é»‘A00001', // VIPè½¦è¾†
    'é»‘B00002', // ç®¡ç†è½¦è¾†
    // ...
];
```

### 5. å®šæ—¶ä»»åŠ¡è‡ªåŠ¨æ‹‰é»‘

**ä¼˜åŒ–ï¼š** ä¸ä»…åœ¨æ·»åŠ è¿è§„æ—¶æ£€æŸ¥ï¼Œè¿˜å®šæœŸæ‰«ææ•°æ®åº“

```javascript
// åç«¯å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨æ‰§è¡Œï¼‰
@Scheduled(cron = "0 0 0 * * ?")
public void autoBlacklistScheduledTask() {
    // æŸ¥è¯¢æ‰€æœ‰è¾¾åˆ°é˜ˆå€¼ä½†æœªæ‹‰é»‘çš„è½¦è¾†
    List<String> plateNumbers = violationRepository.findPlatesExceedingThreshold();
    
    // æ‰¹é‡æ‰§è¡Œè‡ªåŠ¨æ‹‰é»‘
    plateNumbers.forEach(this::performAutoBlacklist);
}
```

---

## ğŸ¯ æ¨èå®æ–½æ–¹æ¡ˆ

### æ¨èï¼šæ–¹æ¡ˆ Aï¼ˆå‰ç«¯å®ç°ï¼‰

**ç†ç”±ï¼š**
1. âœ… å¿«é€Ÿå®æ–½ï¼Œæ— éœ€ç­‰å¾…åç«¯å¼€å‘
2. âœ… å¯å¤ç”¨ç°æœ‰æ¥å£ï¼ˆprocessAllViolationsByPlateï¼‰
3. âœ… é€»è¾‘æ¸…æ™°ï¼Œæ˜“äºè°ƒè¯•å’Œç»´æŠ¤
4. âœ… å‰ç«¯å¯æ§æ€§å¼ºï¼Œçµæ´»è°ƒæ•´

**å®æ–½æ­¥éª¤ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰ï¼š**

1. **Phase 1ï¼šæ ¸å¿ƒåŠŸèƒ½å®ç°**ï¼ˆä¼˜å…ˆçº§ï¼šé«˜ï¼‰
   - âœ… add-violation.vueï¼šå®ç°è‡ªåŠ¨æ‹‰é»‘æ£€æŸ¥å’Œæ‰§è¡Œé€»è¾‘
   - âœ… IllegalRegiste.vueï¼šæ˜¾ç¤ºè¿è§„æ¬¡æ•°å¾½ç« 

2. **Phase 2ï¼šUIä¼˜åŒ–**ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰
   - âœ… è¿è§„æ¬¡æ•°é¢„è­¦æç¤º
   - âœ… è‡ªåŠ¨æ‹‰é»‘æˆåŠŸ/å¤±è´¥æç¤ºä¼˜åŒ–
   - âœ… æ ·å¼ç¾åŒ–

3. **Phase 3ï¼šæ€§èƒ½ä¼˜åŒ–**ï¼ˆä¼˜å…ˆçº§ï¼šä¸­ï¼‰
   - âœ… æ‰¹é‡æŸ¥è¯¢è¿è§„æ¬¡æ•°
   - âœ… ç¼“å­˜æœºåˆ¶

4. **Phase 4ï¼šåŠŸèƒ½æ‰©å±•**ï¼ˆä¼˜å…ˆçº§ï¼šä½ï¼‰
   - âœ… è‡ªåŠ¨æ‹‰é»‘æ—¥å¿—
   - âœ… é€šçŸ¥åŠŸèƒ½
   - âœ… ç™½åå•åŠŸèƒ½

---

## ğŸ”§ å…³é”®ä»£ç ç‰‡æ®µæ€»ç»“

### 1. æ£€æŸ¥è‡ªåŠ¨æ‹‰é»‘é˜ˆå€¼

```javascript
async checkAutoBlacklistThreshold(plateNumber) {
    const config = await violationApi.getMonthlyTicketConfig('2KPL6XFF');
    const threshold = config.data?.data?.maxViolationCount || 5;
    
    const response = await violationApi.getViolations({
        plateNumber: plateNumber,
        processStatus: 'pending',
        page: 1,
        size: 1
    });
    
    const count = response.data?.data?.total || 0;
    return count >= threshold;
}
```

### 2. æ‰§è¡Œè‡ªåŠ¨æ‹‰é»‘

```javascript
async performAutoBlacklist(plateNumber) {
    // è·å–é»‘åå•ç±»å‹
    const types = await violationApi.getBlacklistTypes('ä¸œåŒ—æ—ä¸šå¤§å­¦');
    const blacklistType = types.data?.data?.blacklistTypes?.[0] || {};
    
    // æ„å»ºå¤„ç†å‚æ•°
    const processParams = {
        processRemark: 'ç³»ç»Ÿè‡ªåŠ¨æ‹‰é»‘ï¼šè¿è§„æ¬¡æ•°è¾¾åˆ°é˜ˆå€¼',
        operatorName: 'ç³»ç»Ÿè‡ªåŠ¨',
        shouldBlacklist: true,
        blacklistType: `${blacklistType.code}|${blacklistType.name}`,
        blacklistReason: 'è¿è§„åœè½¦ç´¯è®¡è¾¾åˆ°é˜ˆå€¼',
        isPermanent: true,
        processType: 'auto_blacklist'
    };
    
    // æ‰¹é‡å¤„ç†è¯¥è½¦ç‰Œçš„æ‰€æœ‰æœªå¤„ç†è¿è§„è®°å½•
    await violationApi.processAllViolationsByPlate(plateNumber, processParams);
}
```

### 3. æ˜¾ç¤ºè¿è§„æ¬¡æ•°å¾½ç« 

```vue
<el-badge 
    v-if="row.violationCount && row.violationCount >= configForm.maxViolationCount - 2"
    :value="row.violationCount" 
    :type="row.violationCount >= configForm.maxViolationCount ? 'danger' : 'warning'"
    :max="99">
</el-badge>
```

---

## â“ FAQ

### Q1: è‡ªåŠ¨æ‹‰é»‘æ˜¯æ°¸ä¹…çš„å—ï¼Ÿ
A: é»˜è®¤æ˜¯æ°¸ä¹…æ‹‰é»‘ï¼ˆ`isPermanent: true`ï¼‰ï¼Œå¯ä»¥åœ¨ä»£ç ä¸­è°ƒæ•´ä¸ºä¸´æ—¶æ‹‰é»‘ã€‚

### Q2: å¦‚æœACMSé»‘åå•æ¥å£å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
A: è¿è§„è®°å½•ä¼šæ­£å¸¸æäº¤ï¼Œä½†æ‹‰é»‘æ“ä½œä¼šå¤±è´¥ï¼Œç³»ç»Ÿä¼šæ˜¾ç¤ºé”™è¯¯æç¤ºï¼Œä¸å½±å“è¿è§„è®°å½•çš„æ­£å¸¸ä½¿ç”¨ã€‚

### Q3: å¦‚ä½•ä¿®æ”¹è‡ªåŠ¨æ‹‰é»‘çš„é˜ˆå€¼ï¼Ÿ
A: åœ¨ IllegalRegiste.vue é¡µé¢ç‚¹å‡»"æœˆç¥¨è½¦é…ç½®"æŒ‰é’®ï¼Œä¿®æ”¹"ç´¯è®¡æ¬¡æ•°"å‚æ•°å³å¯ã€‚

### Q4: è‡ªåŠ¨æ‹‰é»‘åå¯ä»¥æ‰‹åŠ¨è§£é™¤å—ï¼Ÿ
A: å¯ä»¥ï¼Œé€šè¿‡ACMSç³»ç»Ÿçš„é»‘åå•ç®¡ç†åŠŸèƒ½æ‰‹åŠ¨è§£é™¤ã€‚

### Q5: å¦‚æœæŸä¸ªè½¦è¾†éœ€è¦è±å…è‡ªåŠ¨æ‹‰é»‘æ€ä¹ˆåŠï¼Ÿ
A: ç›®å‰æš‚ä¸æ”¯æŒï¼Œåç»­å¯ä»¥æ·»åŠ ç™½åå•åŠŸèƒ½ã€‚

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**æœ€åæ›´æ–°ï¼š** 2025-10-06  
**ä½œè€…ï¼š** AI Assistant

